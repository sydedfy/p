{"version":3,"sources":["/source/node_modules/boilerplate-gulp-js/node_modules/browserify/node_modules/browser-pack/_prelude.js","/source/index.js","P.js","/source/lib/Connection.js","/source/lib/ConnectionManager.js","/source/lib/JSONProtocol.js","/source/lib/P.js","/source/lib/WebRtcConnection.js","/source/lib/WebSocketConnection.js","/source/node_modules/boilerplate-gulp-js/node_modules/browserify/node_modules/events/events.js","/source/node_modules/its/index.js","/source/node_modules/its/lib/its.js"],"names":["f","exports","module","define","amd","g","window","global","self","this","P","e","t","n","r","s","o","u","a","require","i","Error","code","l","call","length",1,"./lib/P.js",2,"notImplemented","Connection","address","peers","options","its","string","defined","emitter","firewall","acceptRTCConnection","Emitter","isString","candidate","Object","prototype","toString","JSONProtocol","EventEmitter","createWebRTCConnection","create","on","apply","arguments","removeListener","send","writeMessage","getPeer","get","addPeer","peer","add","getPeers","connect","config","writeOffer","remove","emit","readMessage","message","readArrayBuffer","readRelay","peerAddress","writeRelayedMessage","readRelayedIceCandidate","readIceCandidate","readRelayedOffer","description","data","readOffer","writeAnswer","readRelayedAnswer","readAnswer","close","getReadyState","isOpen","./JSONProtocol.js","events",3,"noop","ConnectionManager","connectionMap","connectionList","undefined","slice","connection","push","onAdd","mappedConnection","index","indexOf","splice","onRemove",4,"PROTOCOL_NAME","MESSAGE_TYPE","DIRECT","RTC_OFFER","RTC_ANSWER","RTC_ICE_CANDIDATE","RELAY","RELAYED","readRaw","ArrayBuffer","readProtocolMessage","JSON","parse","messageType","readRelayedMessage","origin","writeRaw","writeProtocolMessage","serializedMessage","stringify","writeStringMessage","writeRelayMessage","destination","writeRelayAnswer","writeRelayIceCandidate","writeRelayOffer",5,"connectionManager","WebSocketConnection","./ConnectionManager.js","./WebRtcConnection","./WebSocketConnection.js",6,"WebRTCConnection","rtcConnection","signalingChannel","rtcDataChannel","createDataChannel","protocol","_initialRtcDataChannel","bind","addEventListener","event","log","channel","nativeRTCPeerConnection","RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","nativeRTCSessionDescription","RTCSessionDescription","mozRTCSessionDescription","nativeRTCIceCandidate","RTCIceCandidate","mozRTCIceCandidate","P_DEBUGGING_ENABLED","label","obj","console","debug","DEFAULT_RTC_CONFIGURATION","DEFAULT_RTC_OFFER_OPTIONS","offerToReceiveAudio","offerToReceiveVideo","iceRestart","rtcConfiguration","readyState","rtcSessionDescription","setRemoteDescription","addIceCandidate","onError","err","createAnswer","setLocalDescription","createOffer","offerData","rtcOfferOptions","./Connection.js",7,"webSocket","WebSocketState","CONNECTING","OPEN","CLOSING","CLOSED","WebSocket",8,"_events","_maxListeners","isFunction","arg","isNumber","isObject","isUndefined","defaultMaxListeners","setMaxListeners","isNaN","TypeError","type","er","handler","len","args","listeners","error","Array","addListener","listener","m","newListener","warned","trace","once","fired","list","position","removeAllListeners","key","ret","listenerCount",9,"./lib/its.js",10,"templateRegEx","templatedMessage","messageTemplate","messageArguments","result","messageArray","split","join","expression","messageOrErrorType","concat","array","object","types","theType","func","ReferenceError","range","RangeError"],"mappings":"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","file":"P.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","module.exports = require('./lib/P.js');","(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.P = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\nmodule.exports = require('./lib/P.js');\n},{\"./lib/P.js\":5}],2:[function(require,module,exports){\nvar JSONProtocol = require('./JSONProtocol.js'),\n\tits = require('its'),\n\tEmitter = require('events').EventEmitter;\n\nfunction notImplemented(){\n\tthrow new Error('This method is not implemented');\n}\n\nfunction Connection(address, peers, options){\n\tits.string(address);\n\tits.defined(peers);\n\n\tthis.address = address;\n\tthis.peers = peers;\n\n\tif(options){\n\t\tif(options.emitter) this.emitter = options.emitter;\n\t\tif(options.firewall) this.acceptRTCConnection = options.firewall;\n\t}\n\n\tif(!this.emitter) this.emitter = new Connection.Emitter();\n}\n\n// Circular dependency solved in WebRTCConnection.js\nConnection.createWebRTCConnection = null;\n\nConnection.Emitter = Emitter;\n\nConnection.prototype = Object.create(JSONProtocol.prototype);\n\nConnection.prototype.on = function(){\n\tthis.emitter.on.apply(this.emitter, arguments);\n\treturn this;\n};\n\nConnection.prototype.removeListener = function(){\n\tthis.emitter.removeListener.apply(this.emitter, arguments);\n\treturn this;\n};\n\nConnection.prototype.send = JSONProtocol.prototype.writeMessage;\n\nConnection.prototype.getPeer = function(address){\n\treturn this.peers.get(address);\n};\n\nConnection.prototype.addPeer = function(peer){\n\treturn this.peers.add(peer);\n};\n\nConnection.prototype.getPeers = function() {\n\treturn this.peers.get();\n};\n\nfunction isString(candidate){\n\treturn Object.prototype.toString.call(candidate) === '[object String]';\n}\n\nConnection.prototype.connect = function(config){\n\tif(isString(config)){\n\t\tconfig = {address: config};\n\t}\n\n\tvar self = this,\n\t\tfirewall = config.firewall || this.firewall,\n\t\tpeer = Connection.createWebRTCConnection(config, this.peers, this, {firewall: firewall});\n\n\tpeer.writeOffer(config);\n\n\tthis.peers.add(peer);\n\n\tpeer.on('close', function(){\n\t\tself.peers.remove(peer);\n\t\tself.emitter.emit('disconnection', peer);\n\t});\n\n\tthis.emitter.emit('connection', peer);\n\n\treturn peer;\n};\n\nConnection.prototype.readMessage = function(message){\n\tthis.emitter.emit('message', message);\n};\n\nConnection.prototype.readArrayBuffer = function(message){\n\tthis.emitter.emit('arraybuffer', message);\n};\n\nConnection.prototype.acceptRTCConnection = function(/*description, data*/){\n\treturn true;\n};\n\nConnection.prototype.readRelay = function(peerAddress, message){\n\tvar peer = this.getPeer(peerAddress);\n\n\tif(!peer){\n\t\tthis.emitter.emit('error', new Error('Unknown peer at address: ' + peerAddress));\n\t\treturn;\n\t}\n\n\tpeer.writeRelayedMessage(this.address, message);\n};\n\nConnection.prototype.readRelayedIceCandidate = function(peerAddress, candidate){\n\tvar peer = this.getPeer(peerAddress);\n\n\tif(!peer){\n\t\tthis.emitter.emit('error', new Error('Unknown peer at address: ' + peerAddress));\n\t\treturn;\n\t}\n\n\tpeer.readIceCandidate(candidate);\n};\n\nConnection.prototype.readRelayedOffer = function(peerAddress, description, data){\n\tif(!this.acceptRTCConnection(description, data)) return false;\n\n\tvar self = this,\n\t\tpeer = Connection.createWebRTCConnection({address:peerAddress}, this.peers, this, {firewall: this.firewall});\n\n\tthis.addPeer(peer);\n\n\tpeer.on('close', function(){\n\t\tself.peers.remove(peer);\n\t\tself.emitter.emit('disconnection', peer);\n\t});\n\n\tpeer.readOffer(description);\n\tpeer.writeAnswer();\n\n\tthis.emitter.emit('connection', peer);\n};\n\nConnection.prototype.readRelayedAnswer = function(peerAddress, description){\n\tvar peer = this.getPeer(peerAddress);\n\n\tif(!peer){\n\t\tthis.emitter.emit('error', new Error('Unknown peer at address: ' + peerAddress));\n\t\treturn;\n\t}\n\n\tpeer.readAnswer(description);\n};\n\nConnection.prototype.close = notImplemented; // implemented higher up\nConnection.prototype.getReadyState = notImplemented; // implemented higher up\n\nConnection.prototype.isOpen = function(){\n\treturn this.getReadyState() === 'open';\n};\n\nmodule.exports = Connection;\n\n},{\"./JSONProtocol.js\":4,\"events\":8,\"its\":9}],3:[function(require,module,exports){\nvar its = require('its');\n\nfunction noop(){}\n\nfunction ConnectionManager(){\n\tthis.connectionMap = {};\n\tthis.connectionList = [];\n}\n\nConnectionManager.prototype.get = function(address){\n\tif(address === undefined) return this.connectionList.slice();\n\n\treturn this.connectionMap[address];\n};\n\nConnectionManager.prototype.add = function(connection) {\n\tits.defined(connection);\n\n\tvar address = connection.address;\n\tits.string(address);\n\n\tif(address in this.connectionMap) return false;\n\t\n\tthis.connectionMap[address] = connection;\n\tthis.connectionList.push(connection);\n\n\tthis.onAdd(connection);\n\treturn true;\n};\nConnectionManager.prototype.onAdd = noop;\n\nConnectionManager.prototype.remove = function(connection){\n\tits.defined(connection);\n\n\tvar address = connection.address;\n\tits.string(address);\n\n\tvar mappedConnection = this.connectionMap[address];\n\tif(!mappedConnection || mappedConnection !== connection) return false;\n\n\tdelete this.connectionMap[address];\n\t\n\tvar index = this.connectionList.indexOf(connection);\n\tthis.connectionList.splice(index, 1);\n\n\tthis.onRemove(connection);\n\treturn true;\n};\nConnectionManager.prototype.onRemove = noop;\n\nmodule.exports = ConnectionManager;\n},{\"its\":9}],4:[function(require,module,exports){\nfunction notImplemented(){\n\tthrow new Error('This method is not implemented');\n}\n\nfunction JSONProtocol(){}\n\nJSONProtocol.prototype.PROTOCOL_NAME = 'p';\n\nJSONProtocol.prototype.MESSAGE_TYPE = {\n\tDIRECT: 0, // [0, message]\n\n\tRTC_OFFER: 3, // [3, description, data]\n\tRTC_ANSWER: 4, // [4, description]\n\tRTC_ICE_CANDIDATE: 5, // [5, candidate]\n\n\tRELAY: 6, // [6, address, message]\n\tRELAYED: 7 // [7, address, message]\n};\n\nJSONProtocol.prototype.readRaw = function(message){\n\tif(message instanceof ArrayBuffer){\n\t\tthis.readArrayBuffer(message);\n\t} else {\n\t\tthis.readProtocolMessage(JSON.parse(message));\n\t}\t\n};\n\nJSONProtocol.prototype.readProtocolMessage = function(message){\n\tvar MESSAGE_TYPE = this.MESSAGE_TYPE,\n\t\tmessageType = message[0];\n\t\n\tswitch(messageType){\n\t\t// This is a message from the remote node to this one.\n\t\tcase MESSAGE_TYPE.DIRECT:\n\t\t\tthis.readMessage(message[1]);\n\t\t\tbreak;\n\n\t\t// The message was relayed by the peer on behalf of\n\t\t// a third party peer, identified by \"thirdPartyPeerId\".\n\t\t// This means that the peer is acting as a signalling\n\t\t// channel on behalf of the third party peer.\n\t\tcase MESSAGE_TYPE.RELAYED:\n\t\t\tthis.readRelayedMessage(message[1], message[2]);\n\t\t\tbreak;\n\n\t\t// The message is intended for another peer, identified\n\t\t// by \"peerId\", which is also connected to this node.\n\t\t// This means that the peer is using this connection\n\t\t// as a signalling channel in order to establish a connection\n\t\t// to the other peer identified \"peerId\".\n\t\tcase MESSAGE_TYPE.RELAY:\n\t\t\tthis.readRelay(message[1], message[2]);\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tthrow new Error('Unknown message type: ' + messageType);\n\t}\n};\n\nJSONProtocol.prototype.readRelayedMessage = function(origin, message){\n\tvar MESSAGE_TYPE = this.MESSAGE_TYPE,\n\t\tmessageType = message[0];\n\n\tswitch(messageType){\n\t\t// An initial connection request from a third party peer\n\t\tcase MESSAGE_TYPE.RTC_OFFER:\n\t\t\tthis.readRelayedOffer(origin, message[1], message[2]);\n\t\t\tbreak;\n\t\t\n\t\t// An answer to an RTC offer sent from this node\n\t\tcase MESSAGE_TYPE.RTC_ANSWER:\n\t\t\tthis.readRelayedAnswer(origin, message[1]);\n\t\t\tbreak;\n\t\t\n\t\t// An ICE candidate from the source node\n\t\tcase MESSAGE_TYPE.RTC_ICE_CANDIDATE:\n\t\t\tthis.readRelayedIceCandidate(origin, message[1]);\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tthrow new Error('Unknown message type: ' + messageType);\n\t}\t\t\n};\n\nJSONProtocol.prototype.readMessage = notImplemented;\nJSONProtocol.prototype.readArrayBuffer = notImplemented;\nJSONProtocol.prototype.readRelay = notImplemented;\n\nJSONProtocol.prototype.readRelayedOffer = notImplemented;\nJSONProtocol.prototype.readRelayedAnswer = notImplemented;\nJSONProtocol.prototype.readRelayedIceCandidate = notImplemented;\n\nJSONProtocol.prototype.writeRaw = notImplemented;\n\nJSONProtocol.prototype.writeProtocolMessage = function(message){\n\tvar serializedMessage = JSON.stringify(message);\n\tthis.writeRaw(serializedMessage);\n};\n\nJSONProtocol.prototype.writeMessage = function(message){\n\tif(message instanceof ArrayBuffer){\n\t\tthis.writeRaw(message);\n\t} else {\n\t\tthis.writeStringMessage(message);\n\t}\n};\n\nJSONProtocol.prototype.writeStringMessage = function(message){\n\tthis.writeProtocolMessage([\n\t\tthis.MESSAGE_TYPE.DIRECT,\n\t\tmessage\n\t]);\n};\n\nJSONProtocol.prototype.writeRelayedMessage = function(origin, message){\n\tthis.writeProtocolMessage([\n\t\tthis.MESSAGE_TYPE.RELAYED,\n\t\torigin,\n\t\tmessage\n\t]);\n};\n\nJSONProtocol.prototype.writeRelayMessage = function(destination, message){\n\tthis.writeProtocolMessage([\n\t\tthis.MESSAGE_TYPE.RELAY,\n\t\tdestination,\n\t\tmessage\n\t]);\n};\n\nJSONProtocol.prototype.writeRelayAnswer = function(destination, description){\n\tthis.writeRelayMessage(destination, [\n\t\tthis.MESSAGE_TYPE.RTC_ANSWER,\n\t\tdescription\n\t]);\n};\n\nJSONProtocol.prototype.writeRelayIceCandidate = function(destination, candidate){\n\tthis.writeRelayMessage(destination, [\n\t\tthis.MESSAGE_TYPE.RTC_ICE_CANDIDATE,\n\t\tcandidate\n\t]);\n};\n\nJSONProtocol.prototype.writeRelayOffer = function(destination, description, data){\n\tthis.writeRelayMessage(destination, [\n\t\tthis.MESSAGE_TYPE.RTC_OFFER,\n\t\tdescription,\n\t\tdata\n\t]);\n};\n\nmodule.exports = JSONProtocol;\n},{}],5:[function(require,module,exports){\nvar Emitter = require('events').EventEmitter,\n\tConnectionManager = require('./ConnectionManager.js'),\n\tWebSocketConnection = require('./WebSocketConnection.js'),\n\tits = require('its');\n\nrequire('./WebRtcConnection');\n\nfunction P(emitter, connectionManager, options){\n\tits.defined(emitter);\n\tits.defined(connectionManager);\n\n\tthis.emitter = emitter;\n\tthis.peers = connectionManager;\n\n\tthis.peers.onAdd = function(peer){\n\t\temitter.emit('connection', peer);\n\t};\n\n\tthis.peers.onRemove = function(peer){\n\t\temitter.emit('disconnection', peer);\n\t};\n\n\tif(options && options.firewall) this.firewall = options.firewall;\n}\n\nP.create = function(options){\n\tvar emitter = new Emitter(),\n\t\tconnectionManager = new ConnectionManager();\n\n\treturn new P(emitter, connectionManager, options);\n};\n\nP.prototype.getPeers = function(){\n\treturn this.peers.get();\n};\n\nP.prototype.connect = function(address){\n\tits.string(address);\n\n\tvar peers = this.peers,\n\t\tpeer = WebSocketConnection.create(address, this.peers, {firewall: this.firewall});\n\n\tpeers.add(peer);\n\n\tpeer.on('close', function(){\n\t\tpeers.remove(peer);\n\t});\n\n\treturn peer;\n};\n\nP.prototype.on = function(){\n\tthis.emitter.on.apply(this.emitter, arguments);\n\treturn this;\n};\n\nP.prototype.removeListener = function(){\n\tthis.emitter.removeListener.apply(this.emitter, arguments);\n\treturn this;\n};\n\nmodule.exports = P;\n\n},{\"./ConnectionManager.js\":3,\"./WebRtcConnection\":6,\"./WebSocketConnection.js\":7,\"events\":8,\"its\":9}],6:[function(require,module,exports){\n/*global\n\t\tRTCPeerConnection,\n\t\twebkitRTCPeerConnection,\n\t\tmozRTCPeerConnection,\n\t\tRTCSessionDescription,\n\t\tmozRTCSessionDescription,\n\t\tRTCIceCandidate,\n\t\tmozRTCIceCandidate\n*/\n\nvar Connection = require('./Connection.js'),\n\tits = require('its');\n\nvar nativeRTCPeerConnection = (typeof RTCPeerConnection !== 'undefined')? RTCPeerConnection :\n\t\t\t\t\t\t\t  (typeof webkitRTCPeerConnection !== 'undefined')? webkitRTCPeerConnection :\n\t\t\t\t\t\t\t  (typeof mozRTCPeerConnection !== 'undefined')? mozRTCPeerConnection :\n\t\t\t\t\t\t\t  undefined;\n\nvar nativeRTCSessionDescription = (typeof RTCSessionDescription !== 'undefined')? RTCSessionDescription :\n\t\t\t\t\t\t\t\t  (typeof mozRTCSessionDescription !== 'undefined')? mozRTCSessionDescription :\n\t\t\t\t\t\t\t\t  undefined;\nvar nativeRTCIceCandidate = (typeof RTCIceCandidate !== 'undefined')? RTCIceCandidate :\n\t\t\t\t\t\t\t(typeof mozRTCIceCandidate !== 'undefined')? mozRTCIceCandidate :\n\t\t\t\t\t\t\tundefined;\n\nvar log = function(){};\n\nif(typeof window !== 'undefined' && window.P_DEBUGGING_ENABLED){\n\tlog = function(label, event, obj){\n\t\twindow.console.debug(label, event, obj);\n\t};\n}\n\nfunction WebRTCConnection(address, peers, rtcConnection, signalingChannel, options){\n\tvar self = this;\n\n\tits.string(address);\n\tits.defined(peers);\n\tits.defined(rtcConnection);\n\tits.defined(signalingChannel);\n\n\tConnection.call(this, address, peers, options);\n\n\tthis.signalingChannel = signalingChannel;\n\tthis.rtcConnection = rtcConnection;\n\tthis.rtcDataChannel = rtcConnection.createDataChannel(this.PROTOCOL_NAME, {protocol: this.PROTOCOL_NAME});\n\n\n\t// Bug in FF seems to garbage collect the stale ref causing it to close\n\t// the prevents it from being lost in a GC event\n\tthis._initialRtcDataChannel = this.rtcDataChannel;\n\n\n\tthis.close = rtcConnection.close.bind(rtcConnection);\n\n\tthis.rtcConnection.addEventListener('icecandidate', function(event){\n\t\tif(!event.candidate) return;\n\t\tlog('ice candidate', event, self);\n\t\tself.signalingChannel.writeRelayIceCandidate(address, event.candidate);\n\t});\n\n\tthis.rtcConnection.addEventListener('datachannel', function(event){\n\t\tlog('datachannel', event, self);\n\n\t\tvar rtcDataChannel = self.rtcDataChannel = event.channel;\n\t\trtcDataChannel.addEventListener('open', function(event){\n\t\t\tlog('remote datachannel open', event, self);\n\t\t\tself.emitter.emit('open', event);\n\t\t});\n\n\t\trtcDataChannel.addEventListener('close', function(event){\n\t\t\tlog('remote datachannel close', event, self);\n\t\t\tself.emitter.emit('close', event);\n\t\t});\n\n\t\trtcDataChannel.addEventListener('error', function(event){\n\t\t\tlog('remote datachannel error', event, self);\n\t\t\tself.emitter.emit('error', event);\n\t\t});\n\t});\n\n\tthis.rtcDataChannel.addEventListener('message', function(message){\n\t\tlog('local datachannel message', message, self);\n\t\tself.readRaw(message.data);\n\t});\n\n\tthis.rtcDataChannel.addEventListener('error', function(event){\n\t\tlog('local datachannel error', event, self);\n\t\tself.emitter.emit('error', event);\n\t});\n\n\tthis.rtcDataChannel.addEventListener('close', function(event){\n\t\tlog('local datachannel close', event, self);\n\t\tself.emitter.emit('close', event);\n\t});\n}\n\nvar DEFAULT_RTC_CONFIGURATION = null;\nvar DEFAULT_RTC_OFFER_OPTIONS = {\n\tofferToReceiveAudio: false,\n\tofferToReceiveVideo: false,\n\ticeRestart: false\n};\n\n//DEFAULT_RTC_OFFER_OPTIONS\nWebRTCConnection.create = function(config, peers, signalingChannel, options){\n\tvar rtcConfiguration = config.rtcConfiguration || DEFAULT_RTC_CONFIGURATION,\n\t\trtcConnection = new nativeRTCPeerConnection(rtcConfiguration);\n\n\treturn new WebRTCConnection(config.address, peers, rtcConnection, signalingChannel, options);\n};\n\nWebRTCConnection.prototype = Object.create(Connection.prototype);\n\nWebRTCConnection.prototype.writeRaw = function(message){\n\tswitch(this.rtcDataChannel.readyState){\n\t\tcase 'connecting':\n\t\t\tthrow new Error('Can\\'t send a message while RTCDataChannel connecting');\n\t\tcase 'open':\n\t\t\tthis.rtcDataChannel.send(message);\n\t\t\tlog('sent message to remote', message, this);\n\t\t\tbreak;\n\t\tcase 'closing':\n\t\tcase 'closed':\n\t\t\tthrow new Error('Can\\'t send a message while RTCDataChannel is closing or closed');\n\t}\n};\n\nWebRTCConnection.prototype.readAnswer = function(description){\n\tvar rtcSessionDescription = new nativeRTCSessionDescription(description);\n\n\tthis.rtcConnection.setRemoteDescription(rtcSessionDescription);\n};\n\nWebRTCConnection.prototype.readOffer = function(description){\n\tvar rtcSessionDescription = new nativeRTCSessionDescription(description);\n\tthis.rtcConnection.setRemoteDescription(rtcSessionDescription);\n};\n\nWebRTCConnection.prototype.readIceCandidate = function(candidate){\n\tthis.rtcConnection.addIceCandidate(new nativeRTCIceCandidate(candidate));\n};\n\nWebRTCConnection.prototype.writeAnswer = function(){\n\tvar emitter = this.emitter,\n\t\taddress = this.address,\n\t\trtcConnection = this.rtcConnection,\n\t\tsignalingChannel = this.signalingChannel;\n\n\tfunction onError(err){ emitter.emit('error', err); }\n\n\trtcConnection.createAnswer(function(description){\n\t\trtcConnection.setLocalDescription(description, function(){\n\t\t\tsignalingChannel.writeRelayAnswer(address, description);\n\t\t}, onError);\n\t}, onError);\n};\n\nWebRTCConnection.prototype.writeOffer = function(config){\n\tvar emitter = this.emitter,\n\t\taddress = this.address,\n\t\trtcConnection = this.rtcConnection,\n\t\tsignalingChannel = this.signalingChannel;\n\n\tfunction onError(err){ emitter.emit('error', err); }\n\n\trtcConnection.createOffer(function(description){\n\t\trtcConnection.setLocalDescription(description, function(){\n\t\t\tsignalingChannel.writeRelayOffer(address, description, config.offerData);\n\t\t}, onError);\n\t}, onError, config.rtcOfferOptions || DEFAULT_RTC_OFFER_OPTIONS);\n};\n\nWebRTCConnection.prototype.getReadyState = function(){\n\treturn this.rtcDataChannel.readyState;\n};\n\n// Solves the circular dependency with Connection.js\nConnection.createWebRTCConnection = WebRTCConnection.create;\n\nmodule.exports = WebRTCConnection;\n\n},{\"./Connection.js\":2,\"its\":9}],7:[function(require,module,exports){\nvar Connection = require('./Connection.js');\n\nvar WebSocketState = {\n\tCONNECTING: 0,\n\tOPEN: 1,\n\tCLOSING: 2,\n\tCLOSED: 3\n};\n\nif(typeof WebSocket !== 'undefined'){\n\tWebSocketState = WebSocket;\n}\n\nfunction WebSocketConnection(address, peers, webSocket, options){\n\tvar self = this;\n\n\tConnection.call(this, address, peers, options);\n\n\tthis.webSocket = webSocket;\n\n\tthis.close = webSocket.close.bind(webSocket);\n\n\tthis.webSocket.addEventListener('message', function(message){\n\t\tself.readRaw(message.data);\n\t});\n\n\tthis.webSocket.addEventListener('open', function(event){\n\t\tself.emitter.emit('open', event);\n\t});\n\n\tthis.webSocket.addEventListener('error', function(event){\n\t\tself.emitter.emit('error', event);\n\t});\n\n\tthis.webSocket.addEventListener('close', function(event){\n\t\tself.emitter.emit('close', event);\n\t});\n}\n\nWebSocketConnection.create = function(address, peers, options){\n\tvar webSocket = new WebSocket(address, WebSocketConnection.prototype.PROTOCOL_NAME);\n\treturn new WebSocketConnection(address, peers, webSocket, options);\n};\n\nWebSocketConnection.prototype = Object.create(Connection.prototype);\nWebSocketConnection.prototype.writeRaw = function(message){\n\tswitch(this.webSocket.readyState){\n\t\tcase WebSocketState.CONNECTING:\n\t\t\tthrow new Error('Can\\'t send a message while WebSocket connecting');\n\n\t\tcase WebSocketState.OPEN:\n\t\t\tthis.webSocket.send(message);\n\t\t\tbreak;\n\n\t\tcase WebSocketState.CLOSING:\n\t\tcase WebSocketState.CLOSED:\n\t\t\tthrow new Error('Can\\'t send a message while WebSocket is closing or closed');\n\t}\n};\n\nWebSocketConnection.prototype.getReadyState = function(){\n\tswitch(this.webSocket.readyState){\n\t\tcase WebSocketState.CONNECTING:\n\t\t\treturn 'connecting';\n\t\tcase WebSocketState.OPEN:\n\t\t\treturn 'open';\n\t\tcase WebSocketState.CLOSING:\n\t\t\treturn 'closing';\n\t\tcase WebSocketState.CLOSED:\n\t\t\treturn 'closed';\n\t}\n};\n\nmodule.exports = WebSocketConnection;\n\n},{\"./Connection.js\":2}],8:[function(require,module,exports){\n// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      }\n      throw TypeError('Uncaught, unspecified \"error\" event.');\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        len = arguments.length;\n        args = new Array(len - 1);\n        for (i = 1; i < len; i++)\n          args[i - 1] = arguments[i];\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    len = arguments.length;\n    args = new Array(len - 1);\n    for (i = 1; i < len; i++)\n      args[i - 1] = arguments[i];\n\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    var m;\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  var ret;\n  if (!emitter._events || !emitter._events[type])\n    ret = 0;\n  else if (isFunction(emitter._events[type]))\n    ret = 1;\n  else\n    ret = emitter._events[type].length;\n  return ret;\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n\n},{}],9:[function(require,module,exports){\nmodule.exports = require('./lib/its.js');\n},{\"./lib/its.js\":10}],10:[function(require,module,exports){\n// Helpers\r\nvar slice = Array.prototype.slice;\r\nvar toString = Object.prototype.toString;\r\n\r\nvar templateRegEx = /%s/; // The template placeholder, used to split message templates\r\n\r\n/** A basic templating function. \r\n\t\r\n\tTakes a string with 0 or more '%s' placeholders and an array to populate it with.\r\n\r\n\t@param {String} messageTemplate A string which may or may not have 0 or more '%s' to denote argument placement\r\n\t@param {Array} [messageArguments] Items to populate the template with\r\n\r\n\t@example\r\n\t\ttemplatedMessage(\"Hello\"); // returns \"Hello\"\r\n\t\ttemplatedMessage(\"Hello, %s\", [\"world\"]); // returns \"Hello, world\"\r\n\t\ttemplatedMessage(\"Hello, %s. It's %s degrees outside.\", [\"world\", 72]); // returns \"Hello, world. It's 72 degrees outside\"\r\n\r\n\t@returns {String} The resolved message\r\n*/\r\nvar templatedMessage = function(messageTemplate, messageArguments){\r\n\tvar result = [],\r\n\t\tmessageArray = messageTemplate.split(templateRegEx),\r\n\t\tindex = 0,\r\n\t\tlength = messageArray.length;\r\n\r\n\tfor(; index < length; index++){\r\n\t\tresult.push(messageArray[index]);\r\n\t\tresult.push(messageArguments[index]);\r\n\t}\r\n\r\n\treturn result.join('');\r\n};\r\n\r\n\r\n/** Generic check function which throws an error if a given expression is false\r\n*\r\n*\tThe params list is a bit confusing, check the examples to see the available ways of calling this function\r\n*\r\n*\t@param {Boolean} expression The determinant of whether an exception is thrown\r\n*\t@param {String|Object} [messageOrErrorType] A message or an ErrorType object to throw if expression is false\r\n*   @param {String|Object} [messageOrMessageArgs] A message, message template, or a message argument\r\n*\t@param {...Object} [messageArgs] Arguments for a provided message template\r\n*\r\n*\t@returns {Boolean} Returns the expression passed  \r\n*\t@throws {Error}\r\n*\r\n*\t@example\r\n*\t\tits(0 < 10); // returns true\r\n*\t\tits(0 > 10); // throws Error with no message\r\n*\t\tits(0 > 10, \"Something went wrong!\"); // throws Error with message: \"Something went wrong!\"\r\n*\t\tits(0 > 10, \"%s went %s!\", \"something\", \"wrong\"); // throws Error with message: \"Something went wrong!\"\r\n*\t\tits(0 > 10, RangeError, \"%s went %s!\", \"something\", \"wrong\"); // throws RangeError with message: \"Something went wrong!\"\r\n*\t\tits(0 > 10, RangeError); // throws RangeError with no message\r\n*/\r\nvar its = module.exports = function(expression, messageOrErrorType){\r\n\tif(expression === false){\r\n\t\tif(messageOrErrorType && typeof messageOrErrorType !== \"string\"){ // Check if custom error object passed\r\n\t\t\tthrow messageOrErrorType(arguments.length > 3 ? templatedMessage(arguments[2], slice.call(arguments,3)) : arguments[2]);\t\r\n\t\t} else {\r\n\t\t\tthrow new Error(arguments.length > 2 ? templatedMessage(messageOrErrorType, slice.call(arguments,2)) : messageOrErrorType);\t\r\n\t\t}\r\n\t}\r\n\treturn expression;\r\n};\r\n\r\n/** Throws a TypeError if a given expression is false\r\n*\r\n*\t@param {Boolean} expression The determinant of whether an exception is thrown\r\n*\t@param {String} [message] A message or message template for the error (if it gets thrown)\r\n*\t@param {...Object} [messageArgs] Arguments for a provided message template\r\n*\r\n*\t@returns {Boolean} Returns the expression passed  \r\n*\t@throws {TypeError}\r\n*\r\n*\t@example\r\n*\t\tits.type(typeof \"Team\" === \"string\"); // returns true\r\n*\t\tits.type(typeof \"Team\" === \"number\"); // throws TypeError with no message\r\n*\t\tits.type(void 0, \"Something went wrong!\"); // throws TypeError with message: \"Something went wrong!\"\r\n*\t\tits.type(void 0, \"%s went %s!\", \"something\", \"wrong\"); // throws TypeError with message: \"Something went wrong!\"\r\n*/\r\nits.type = function(expression, message){\r\n\tif(expression === false){\r\n\t\tthrow new TypeError(arguments.length > 2 ? templatedMessage(message, slice.call(arguments,2)) : message);\r\n\t}\r\n\treturn expression;\r\n};\r\n\r\n// Helpers\r\nits.undefined = function(expression){\r\n\treturn its.type.apply(null, [expression === void 0].concat(slice.call(arguments, 1)));\r\n};\r\n\r\nits.null = function(expression){\r\n\treturn its.type.apply(null, [expression === null].concat(slice.call(arguments, 1)));\r\n};\r\n\r\nits.boolean = function(expression){\r\n\treturn its.type.apply(null, [expression === true || expression === false || toString.call(expression) === \"[object Boolean]\"].concat(slice.call(arguments, 1)));\r\n};\r\n\r\nits.array = function(expression){\r\n\treturn its.type.apply(null, [toString.call(expression) === \"[object Array]\"].concat(slice.call(arguments, 1)));\r\n};\r\n\r\nits.object = function(expression){\r\n\treturn its.type.apply(null, [expression === Object(expression)].concat(slice.call(arguments, 1)));\r\n};\r\n\r\n/** This block creates \r\n*\tits.function\r\n*\tits.string\r\n*\tits.number\r\n*\tits.date\r\n*\tits.regexp\r\n*/\r\n(function(){\r\n\tvar types = [\r\n\t\t\t['args','Arguments'],\r\n\t\t\t['func', 'Function'], \r\n\t\t\t['string', 'String'], \r\n\t\t\t['number', 'Number'], \r\n\t\t\t['date', 'Date'], \r\n\t\t\t['regexp', 'RegExp']\r\n\t\t],\r\n\t\tindex = 0,\r\n\t\tlength = types.length;\r\n\r\n\tfor(; index < length; index++){\r\n\t\t(function(){\r\n\t\t\tvar theType = types[index];\r\n\t\t\tits[theType[0]] = function(expression){\r\n\t\t\t\treturn its.type.apply(null, [toString.call(expression) === '[object ' + theType[1] + ']'].concat(slice.call(arguments, 1)));\r\n\t\t\t};\r\n\t\t}());\r\n\t}\r\n}());\r\n\r\n// optimization from underscore.js by documentcloud -- underscorejs.org\r\nif (typeof (/./) !== 'function') {\r\n\tits.func = function(expression) {\r\n\t\treturn its.type.apply(null, [typeof expression === \"function\"].concat(slice.call(arguments, 1)));\r\n\t};\r\n}\r\n\r\n/** Throws a ReferenceError if a given expression is false\r\n*\r\n*\t@param {Boolean} expression The determinant of whether an exception is thrown\r\n*\t@param {String} [message] A message or message template for the error (if it gets thrown)\r\n*\t@param {...Object} [messageArgs] Arguments for a provided message template\r\n*\r\n*\t@returns {Object} Returns the expression passed  \r\n*\t@throws {ReferenceError}\r\n*\r\n*\t@example\r\n*\t\tits.defined(\"Something\"); // returns true\r\n*\t\tits.defined(void 0); // throws ReferenceError with no message\r\n*\t\tits.defined(void 0, \"Something went wrong!\"); // throws ReferenceError with message: \"Something went wrong!\"\r\n*\t\tits.defined(void 0, \"%s went %s!\", \"something\", \"wrong\"); // throws ReferenceError with message: \"Something went wrong!\"\r\n*/\r\nits.defined = function(expression, message){\r\n\tif(expression === void 0){\r\n\t\tthrow new ReferenceError(arguments.length > 2 ? templatedMessage(message, slice.call(arguments,2)) : message);\r\n\t}\r\n\r\n\treturn expression;\r\n};\r\n\r\n/** Throws a RangeError if a given expression is false\r\n*\r\n*\t@param {Boolean} expression The determinant of whether an exception is thrown\r\n*\t@param {String} [message] A message or message template for the error (if it gets thrown)\r\n*\t@param {...Object} [messageArgs] Arguments for a provided message template\r\n*\r\n*\t@returns {Boolean} Returns the expression passed  \r\n*\t@throws {RangeError}\r\n*\r\n*\t@example\r\n*\t\tits.range(1 > 0); // returns true\r\n*\t\tits.range(1 < 2); // throws RangeError with no message\r\n*\t\tits.range(1 < 2 && 1 > 2, \"Something went wrong!\"); // throws RangeError with message: \"Something went wrong!\"\r\n*\t\tits.range(1 < 2 && 1 > 2, \"%s went %s!\", \"something\", \"wrong\"); // throws RangeError with message: \"Something went wrong!\"\r\n*/\r\nits.range = function(expression, message){\r\n\tif(expression === false){\r\n\t\tthrow new RangeError(arguments.length > 2 ? templatedMessage(message, slice.call(arguments,2)) : message);\r\n\t}\r\n\r\n\treturn expression;\r\n};\n},{}]},{},[1])(1)\n});\n\n\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9ib2lsZXJwbGF0ZS1ndWxwLWpzL25vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJpbmRleC5qcyIsImxpYi9Db25uZWN0aW9uLmpzIiwibGliL0Nvbm5lY3Rpb25NYW5hZ2VyLmpzIiwibGliL0pTT05Qcm90b2NvbC5qcyIsImxpYi9QLmpzIiwibGliL1dlYlJ0Y0Nvbm5lY3Rpb24uanMiLCJsaWIvV2ViU29ja2V0Q29ubmVjdGlvbi5qcyIsIm5vZGVfbW9kdWxlcy9ib2lsZXJwbGF0ZS1ndWxwLWpzL25vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9ldmVudHMvZXZlbnRzLmpzIiwibm9kZV9tb2R1bGVzL2l0cy9pbmRleC5qcyIsIm5vZGVfbW9kdWxlcy9pdHMvbGliL2l0cy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBOztBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN1NBOztBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6IlAuanMiLCJzb3VyY2VSb290IjoiL3NvdXJjZS8iLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgnLi9saWIvUC5qcycpOyIsInZhciBKU09OUHJvdG9jb2wgPSByZXF1aXJlKCcuL0pTT05Qcm90b2NvbC5qcycpLFxuXHRpdHMgPSByZXF1aXJlKCdpdHMnKSxcblx0RW1pdHRlciA9IHJlcXVpcmUoJ2V2ZW50cycpLkV2ZW50RW1pdHRlcjtcblxuZnVuY3Rpb24gbm90SW1wbGVtZW50ZWQoKXtcblx0dGhyb3cgbmV3IEVycm9yKCdUaGlzIG1ldGhvZCBpcyBub3QgaW1wbGVtZW50ZWQnKTtcbn1cblxuZnVuY3Rpb24gQ29ubmVjdGlvbihhZGRyZXNzLCBwZWVycywgb3B0aW9ucyl7XG5cdGl0cy5zdHJpbmcoYWRkcmVzcyk7XG5cdGl0cy5kZWZpbmVkKHBlZXJzKTtcblxuXHR0aGlzLmFkZHJlc3MgPSBhZGRyZXNzO1xuXHR0aGlzLnBlZXJzID0gcGVlcnM7XG5cblx0aWYob3B0aW9ucyl7XG5cdFx0aWYob3B0aW9ucy5lbWl0dGVyKSB0aGlzLmVtaXR0ZXIgPSBvcHRpb25zLmVtaXR0ZXI7XG5cdFx0aWYob3B0aW9ucy5maXJld2FsbCkgdGhpcy5hY2NlcHRSVENDb25uZWN0aW9uID0gb3B0aW9ucy5maXJld2FsbDtcblx0fVxuXG5cdGlmKCF0aGlzLmVtaXR0ZXIpIHRoaXMuZW1pdHRlciA9IG5ldyBDb25uZWN0aW9uLkVtaXR0ZXIoKTtcbn1cblxuLy8gQ2lyY3VsYXIgZGVwZW5kZW5jeSBzb2x2ZWQgaW4gV2ViUlRDQ29ubmVjdGlvbi5qc1xuQ29ubmVjdGlvbi5jcmVhdGVXZWJSVENDb25uZWN0aW9uID0gbnVsbDtcblxuQ29ubmVjdGlvbi5FbWl0dGVyID0gRW1pdHRlcjtcblxuQ29ubmVjdGlvbi5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEpTT05Qcm90b2NvbC5wcm90b3R5cGUpO1xuXG5Db25uZWN0aW9uLnByb3RvdHlwZS5vbiA9IGZ1bmN0aW9uKCl7XG5cdHRoaXMuZW1pdHRlci5vbi5hcHBseSh0aGlzLmVtaXR0ZXIsIGFyZ3VtZW50cyk7XG5cdHJldHVybiB0aGlzO1xufTtcblxuQ29ubmVjdGlvbi5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXIgPSBmdW5jdGlvbigpe1xuXHR0aGlzLmVtaXR0ZXIucmVtb3ZlTGlzdGVuZXIuYXBwbHkodGhpcy5lbWl0dGVyLCBhcmd1bWVudHMpO1xuXHRyZXR1cm4gdGhpcztcbn07XG5cbkNvbm5lY3Rpb24ucHJvdG90eXBlLnNlbmQgPSBKU09OUHJvdG9jb2wucHJvdG90eXBlLndyaXRlTWVzc2FnZTtcblxuQ29ubmVjdGlvbi5wcm90b3R5cGUuZ2V0UGVlciA9IGZ1bmN0aW9uKGFkZHJlc3Mpe1xuXHRyZXR1cm4gdGhpcy5wZWVycy5nZXQoYWRkcmVzcyk7XG59O1xuXG5Db25uZWN0aW9uLnByb3RvdHlwZS5hZGRQZWVyID0gZnVuY3Rpb24ocGVlcil7XG5cdHJldHVybiB0aGlzLnBlZXJzLmFkZChwZWVyKTtcbn07XG5cbkNvbm5lY3Rpb24ucHJvdG90eXBlLmdldFBlZXJzID0gZnVuY3Rpb24oKSB7XG5cdHJldHVybiB0aGlzLnBlZXJzLmdldCgpO1xufTtcblxuZnVuY3Rpb24gaXNTdHJpbmcoY2FuZGlkYXRlKXtcblx0cmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChjYW5kaWRhdGUpID09PSAnW29iamVjdCBTdHJpbmddJztcbn1cblxuQ29ubmVjdGlvbi5wcm90b3R5cGUuY29ubmVjdCA9IGZ1bmN0aW9uKGNvbmZpZyl7XG5cdGlmKGlzU3RyaW5nKGNvbmZpZykpe1xuXHRcdGNvbmZpZyA9IHthZGRyZXNzOiBjb25maWd9O1xuXHR9XG5cblx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdGZpcmV3YWxsID0gY29uZmlnLmZpcmV3YWxsIHx8IHRoaXMuZmlyZXdhbGwsXG5cdFx0cGVlciA9IENvbm5lY3Rpb24uY3JlYXRlV2ViUlRDQ29ubmVjdGlvbihjb25maWcsIHRoaXMucGVlcnMsIHRoaXMsIHtmaXJld2FsbDogZmlyZXdhbGx9KTtcblxuXHRwZWVyLndyaXRlT2ZmZXIoY29uZmlnKTtcblxuXHR0aGlzLnBlZXJzLmFkZChwZWVyKTtcblxuXHRwZWVyLm9uKCdjbG9zZScsIGZ1bmN0aW9uKCl7XG5cdFx0c2VsZi5wZWVycy5yZW1vdmUocGVlcik7XG5cdFx0c2VsZi5lbWl0dGVyLmVtaXQoJ2Rpc2Nvbm5lY3Rpb24nLCBwZWVyKTtcblx0fSk7XG5cblx0dGhpcy5lbWl0dGVyLmVtaXQoJ2Nvbm5lY3Rpb24nLCBwZWVyKTtcblxuXHRyZXR1cm4gcGVlcjtcbn07XG5cbkNvbm5lY3Rpb24ucHJvdG90eXBlLnJlYWRNZXNzYWdlID0gZnVuY3Rpb24obWVzc2FnZSl7XG5cdHRoaXMuZW1pdHRlci5lbWl0KCdtZXNzYWdlJywgbWVzc2FnZSk7XG59O1xuXG5Db25uZWN0aW9uLnByb3RvdHlwZS5yZWFkQXJyYXlCdWZmZXIgPSBmdW5jdGlvbihtZXNzYWdlKXtcblx0dGhpcy5lbWl0dGVyLmVtaXQoJ2FycmF5YnVmZmVyJywgbWVzc2FnZSk7XG59O1xuXG5Db25uZWN0aW9uLnByb3RvdHlwZS5hY2NlcHRSVENDb25uZWN0aW9uID0gZnVuY3Rpb24oLypkZXNjcmlwdGlvbiwgZGF0YSovKXtcblx0cmV0dXJuIHRydWU7XG59O1xuXG5Db25uZWN0aW9uLnByb3RvdHlwZS5yZWFkUmVsYXkgPSBmdW5jdGlvbihwZWVyQWRkcmVzcywgbWVzc2FnZSl7XG5cdHZhciBwZWVyID0gdGhpcy5nZXRQZWVyKHBlZXJBZGRyZXNzKTtcblxuXHRpZighcGVlcil7XG5cdFx0dGhpcy5lbWl0dGVyLmVtaXQoJ2Vycm9yJywgbmV3IEVycm9yKCdVbmtub3duIHBlZXIgYXQgYWRkcmVzczogJyArIHBlZXJBZGRyZXNzKSk7XG5cdFx0cmV0dXJuO1xuXHR9XG5cblx0cGVlci53cml0ZVJlbGF5ZWRNZXNzYWdlKHRoaXMuYWRkcmVzcywgbWVzc2FnZSk7XG59O1xuXG5Db25uZWN0aW9uLnByb3RvdHlwZS5yZWFkUmVsYXllZEljZUNhbmRpZGF0ZSA9IGZ1bmN0aW9uKHBlZXJBZGRyZXNzLCBjYW5kaWRhdGUpe1xuXHR2YXIgcGVlciA9IHRoaXMuZ2V0UGVlcihwZWVyQWRkcmVzcyk7XG5cblx0aWYoIXBlZXIpe1xuXHRcdHRoaXMuZW1pdHRlci5lbWl0KCdlcnJvcicsIG5ldyBFcnJvcignVW5rbm93biBwZWVyIGF0IGFkZHJlc3M6ICcgKyBwZWVyQWRkcmVzcykpO1xuXHRcdHJldHVybjtcblx0fVxuXG5cdHBlZXIucmVhZEljZUNhbmRpZGF0ZShjYW5kaWRhdGUpO1xufTtcblxuQ29ubmVjdGlvbi5wcm90b3R5cGUucmVhZFJlbGF5ZWRPZmZlciA9IGZ1bmN0aW9uKHBlZXJBZGRyZXNzLCBkZXNjcmlwdGlvbiwgZGF0YSl7XG5cdGlmKCF0aGlzLmFjY2VwdFJUQ0Nvbm5lY3Rpb24oZGVzY3JpcHRpb24sIGRhdGEpKSByZXR1cm4gZmFsc2U7XG5cblx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdHBlZXIgPSBDb25uZWN0aW9uLmNyZWF0ZVdlYlJUQ0Nvbm5lY3Rpb24oe2FkZHJlc3M6cGVlckFkZHJlc3N9LCB0aGlzLnBlZXJzLCB0aGlzLCB7ZmlyZXdhbGw6IHRoaXMuZmlyZXdhbGx9KTtcblxuXHR0aGlzLmFkZFBlZXIocGVlcik7XG5cblx0cGVlci5vbignY2xvc2UnLCBmdW5jdGlvbigpe1xuXHRcdHNlbGYucGVlcnMucmVtb3ZlKHBlZXIpO1xuXHRcdHNlbGYuZW1pdHRlci5lbWl0KCdkaXNjb25uZWN0aW9uJywgcGVlcik7XG5cdH0pO1xuXG5cdHBlZXIucmVhZE9mZmVyKGRlc2NyaXB0aW9uKTtcblx0cGVlci53cml0ZUFuc3dlcigpO1xuXG5cdHRoaXMuZW1pdHRlci5lbWl0KCdjb25uZWN0aW9uJywgcGVlcik7XG59O1xuXG5Db25uZWN0aW9uLnByb3RvdHlwZS5yZWFkUmVsYXllZEFuc3dlciA9IGZ1bmN0aW9uKHBlZXJBZGRyZXNzLCBkZXNjcmlwdGlvbil7XG5cdHZhciBwZWVyID0gdGhpcy5nZXRQZWVyKHBlZXJBZGRyZXNzKTtcblxuXHRpZighcGVlcil7XG5cdFx0dGhpcy5lbWl0dGVyLmVtaXQoJ2Vycm9yJywgbmV3IEVycm9yKCdVbmtub3duIHBlZXIgYXQgYWRkcmVzczogJyArIHBlZXJBZGRyZXNzKSk7XG5cdFx0cmV0dXJuO1xuXHR9XG5cblx0cGVlci5yZWFkQW5zd2VyKGRlc2NyaXB0aW9uKTtcbn07XG5cbkNvbm5lY3Rpb24ucHJvdG90eXBlLmNsb3NlID0gbm90SW1wbGVtZW50ZWQ7IC8vIGltcGxlbWVudGVkIGhpZ2hlciB1cFxuQ29ubmVjdGlvbi5wcm90b3R5cGUuZ2V0UmVhZHlTdGF0ZSA9IG5vdEltcGxlbWVudGVkOyAvLyBpbXBsZW1lbnRlZCBoaWdoZXIgdXBcblxuQ29ubmVjdGlvbi5wcm90b3R5cGUuaXNPcGVuID0gZnVuY3Rpb24oKXtcblx0cmV0dXJuIHRoaXMuZ2V0UmVhZHlTdGF0ZSgpID09PSAnb3Blbic7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IENvbm5lY3Rpb247XG4iLCJ2YXIgaXRzID0gcmVxdWlyZSgnaXRzJyk7XG5cbmZ1bmN0aW9uIG5vb3AoKXt9XG5cbmZ1bmN0aW9uIENvbm5lY3Rpb25NYW5hZ2VyKCl7XG5cdHRoaXMuY29ubmVjdGlvbk1hcCA9IHt9O1xuXHR0aGlzLmNvbm5lY3Rpb25MaXN0ID0gW107XG59XG5cbkNvbm5lY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbihhZGRyZXNzKXtcblx0aWYoYWRkcmVzcyA9PT0gdW5kZWZpbmVkKSByZXR1cm4gdGhpcy5jb25uZWN0aW9uTGlzdC5zbGljZSgpO1xuXG5cdHJldHVybiB0aGlzLmNvbm5lY3Rpb25NYXBbYWRkcmVzc107XG59O1xuXG5Db25uZWN0aW9uTWFuYWdlci5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24oY29ubmVjdGlvbikge1xuXHRpdHMuZGVmaW5lZChjb25uZWN0aW9uKTtcblxuXHR2YXIgYWRkcmVzcyA9IGNvbm5lY3Rpb24uYWRkcmVzcztcblx0aXRzLnN0cmluZyhhZGRyZXNzKTtcblxuXHRpZihhZGRyZXNzIGluIHRoaXMuY29ubmVjdGlvbk1hcCkgcmV0dXJuIGZhbHNlO1xuXHRcblx0dGhpcy5jb25uZWN0aW9uTWFwW2FkZHJlc3NdID0gY29ubmVjdGlvbjtcblx0dGhpcy5jb25uZWN0aW9uTGlzdC5wdXNoKGNvbm5lY3Rpb24pO1xuXG5cdHRoaXMub25BZGQoY29ubmVjdGlvbik7XG5cdHJldHVybiB0cnVlO1xufTtcbkNvbm5lY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5vbkFkZCA9IG5vb3A7XG5cbkNvbm5lY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbihjb25uZWN0aW9uKXtcblx0aXRzLmRlZmluZWQoY29ubmVjdGlvbik7XG5cblx0dmFyIGFkZHJlc3MgPSBjb25uZWN0aW9uLmFkZHJlc3M7XG5cdGl0cy5zdHJpbmcoYWRkcmVzcyk7XG5cblx0dmFyIG1hcHBlZENvbm5lY3Rpb24gPSB0aGlzLmNvbm5lY3Rpb25NYXBbYWRkcmVzc107XG5cdGlmKCFtYXBwZWRDb25uZWN0aW9uIHx8IG1hcHBlZENvbm5lY3Rpb24gIT09IGNvbm5lY3Rpb24pIHJldHVybiBmYWxzZTtcblxuXHRkZWxldGUgdGhpcy5jb25uZWN0aW9uTWFwW2FkZHJlc3NdO1xuXHRcblx0dmFyIGluZGV4ID0gdGhpcy5jb25uZWN0aW9uTGlzdC5pbmRleE9mKGNvbm5lY3Rpb24pO1xuXHR0aGlzLmNvbm5lY3Rpb25MaXN0LnNwbGljZShpbmRleCwgMSk7XG5cblx0dGhpcy5vblJlbW92ZShjb25uZWN0aW9uKTtcblx0cmV0dXJuIHRydWU7XG59O1xuQ29ubmVjdGlvbk1hbmFnZXIucHJvdG90eXBlLm9uUmVtb3ZlID0gbm9vcDtcblxubW9kdWxlLmV4cG9ydHMgPSBDb25uZWN0aW9uTWFuYWdlcjsiLCJmdW5jdGlvbiBub3RJbXBsZW1lbnRlZCgpe1xuXHR0aHJvdyBuZXcgRXJyb3IoJ1RoaXMgbWV0aG9kIGlzIG5vdCBpbXBsZW1lbnRlZCcpO1xufVxuXG5mdW5jdGlvbiBKU09OUHJvdG9jb2woKXt9XG5cbkpTT05Qcm90b2NvbC5wcm90b3R5cGUuUFJPVE9DT0xfTkFNRSA9ICdwJztcblxuSlNPTlByb3RvY29sLnByb3RvdHlwZS5NRVNTQUdFX1RZUEUgPSB7XG5cdERJUkVDVDogMCwgLy8gWzAsIG1lc3NhZ2VdXG5cblx0UlRDX09GRkVSOiAzLCAvLyBbMywgZGVzY3JpcHRpb24sIGRhdGFdXG5cdFJUQ19BTlNXRVI6IDQsIC8vIFs0LCBkZXNjcmlwdGlvbl1cblx0UlRDX0lDRV9DQU5ESURBVEU6IDUsIC8vIFs1LCBjYW5kaWRhdGVdXG5cblx0UkVMQVk6IDYsIC8vIFs2LCBhZGRyZXNzLCBtZXNzYWdlXVxuXHRSRUxBWUVEOiA3IC8vIFs3LCBhZGRyZXNzLCBtZXNzYWdlXVxufTtcblxuSlNPTlByb3RvY29sLnByb3RvdHlwZS5yZWFkUmF3ID0gZnVuY3Rpb24obWVzc2FnZSl7XG5cdGlmKG1lc3NhZ2UgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcil7XG5cdFx0dGhpcy5yZWFkQXJyYXlCdWZmZXIobWVzc2FnZSk7XG5cdH0gZWxzZSB7XG5cdFx0dGhpcy5yZWFkUHJvdG9jb2xNZXNzYWdlKEpTT04ucGFyc2UobWVzc2FnZSkpO1xuXHR9XHRcbn07XG5cbkpTT05Qcm90b2NvbC5wcm90b3R5cGUucmVhZFByb3RvY29sTWVzc2FnZSA9IGZ1bmN0aW9uKG1lc3NhZ2Upe1xuXHR2YXIgTUVTU0FHRV9UWVBFID0gdGhpcy5NRVNTQUdFX1RZUEUsXG5cdFx0bWVzc2FnZVR5cGUgPSBtZXNzYWdlWzBdO1xuXHRcblx0c3dpdGNoKG1lc3NhZ2VUeXBlKXtcblx0XHQvLyBUaGlzIGlzIGEgbWVzc2FnZSBmcm9tIHRoZSByZW1vdGUgbm9kZSB0byB0aGlzIG9uZS5cblx0XHRjYXNlIE1FU1NBR0VfVFlQRS5ESVJFQ1Q6XG5cdFx0XHR0aGlzLnJlYWRNZXNzYWdlKG1lc3NhZ2VbMV0pO1xuXHRcdFx0YnJlYWs7XG5cblx0XHQvLyBUaGUgbWVzc2FnZSB3YXMgcmVsYXllZCBieSB0aGUgcGVlciBvbiBiZWhhbGYgb2Zcblx0XHQvLyBhIHRoaXJkIHBhcnR5IHBlZXIsIGlkZW50aWZpZWQgYnkgXCJ0aGlyZFBhcnR5UGVlcklkXCIuXG5cdFx0Ly8gVGhpcyBtZWFucyB0aGF0IHRoZSBwZWVyIGlzIGFjdGluZyBhcyBhIHNpZ25hbGxpbmdcblx0XHQvLyBjaGFubmVsIG9uIGJlaGFsZiBvZiB0aGUgdGhpcmQgcGFydHkgcGVlci5cblx0XHRjYXNlIE1FU1NBR0VfVFlQRS5SRUxBWUVEOlxuXHRcdFx0dGhpcy5yZWFkUmVsYXllZE1lc3NhZ2UobWVzc2FnZVsxXSwgbWVzc2FnZVsyXSk7XG5cdFx0XHRicmVhaztcblxuXHRcdC8vIFRoZSBtZXNzYWdlIGlzIGludGVuZGVkIGZvciBhbm90aGVyIHBlZXIsIGlkZW50aWZpZWRcblx0XHQvLyBieSBcInBlZXJJZFwiLCB3aGljaCBpcyBhbHNvIGNvbm5lY3RlZCB0byB0aGlzIG5vZGUuXG5cdFx0Ly8gVGhpcyBtZWFucyB0aGF0IHRoZSBwZWVyIGlzIHVzaW5nIHRoaXMgY29ubmVjdGlvblxuXHRcdC8vIGFzIGEgc2lnbmFsbGluZyBjaGFubmVsIGluIG9yZGVyIHRvIGVzdGFibGlzaCBhIGNvbm5lY3Rpb25cblx0XHQvLyB0byB0aGUgb3RoZXIgcGVlciBpZGVudGlmaWVkIFwicGVlcklkXCIuXG5cdFx0Y2FzZSBNRVNTQUdFX1RZUEUuUkVMQVk6XG5cdFx0XHR0aGlzLnJlYWRSZWxheShtZXNzYWdlWzFdLCBtZXNzYWdlWzJdKTtcblx0XHRcdGJyZWFrO1xuXG5cdFx0ZGVmYXVsdDpcblx0XHRcdHRocm93IG5ldyBFcnJvcignVW5rbm93biBtZXNzYWdlIHR5cGU6ICcgKyBtZXNzYWdlVHlwZSk7XG5cdH1cbn07XG5cbkpTT05Qcm90b2NvbC5wcm90b3R5cGUucmVhZFJlbGF5ZWRNZXNzYWdlID0gZnVuY3Rpb24ob3JpZ2luLCBtZXNzYWdlKXtcblx0dmFyIE1FU1NBR0VfVFlQRSA9IHRoaXMuTUVTU0FHRV9UWVBFLFxuXHRcdG1lc3NhZ2VUeXBlID0gbWVzc2FnZVswXTtcblxuXHRzd2l0Y2gobWVzc2FnZVR5cGUpe1xuXHRcdC8vIEFuIGluaXRpYWwgY29ubmVjdGlvbiByZXF1ZXN0IGZyb20gYSB0aGlyZCBwYXJ0eSBwZWVyXG5cdFx0Y2FzZSBNRVNTQUdFX1RZUEUuUlRDX09GRkVSOlxuXHRcdFx0dGhpcy5yZWFkUmVsYXllZE9mZmVyKG9yaWdpbiwgbWVzc2FnZVsxXSwgbWVzc2FnZVsyXSk7XG5cdFx0XHRicmVhaztcblx0XHRcblx0XHQvLyBBbiBhbnN3ZXIgdG8gYW4gUlRDIG9mZmVyIHNlbnQgZnJvbSB0aGlzIG5vZGVcblx0XHRjYXNlIE1FU1NBR0VfVFlQRS5SVENfQU5TV0VSOlxuXHRcdFx0dGhpcy5yZWFkUmVsYXllZEFuc3dlcihvcmlnaW4sIG1lc3NhZ2VbMV0pO1xuXHRcdFx0YnJlYWs7XG5cdFx0XG5cdFx0Ly8gQW4gSUNFIGNhbmRpZGF0ZSBmcm9tIHRoZSBzb3VyY2Ugbm9kZVxuXHRcdGNhc2UgTUVTU0FHRV9UWVBFLlJUQ19JQ0VfQ0FORElEQVRFOlxuXHRcdFx0dGhpcy5yZWFkUmVsYXllZEljZUNhbmRpZGF0ZShvcmlnaW4sIG1lc3NhZ2VbMV0pO1xuXHRcdFx0YnJlYWs7XG5cblx0XHRkZWZhdWx0OlxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKCdVbmtub3duIG1lc3NhZ2UgdHlwZTogJyArIG1lc3NhZ2VUeXBlKTtcblx0fVx0XHRcbn07XG5cbkpTT05Qcm90b2NvbC5wcm90b3R5cGUucmVhZE1lc3NhZ2UgPSBub3RJbXBsZW1lbnRlZDtcbkpTT05Qcm90b2NvbC5wcm90b3R5cGUucmVhZEFycmF5QnVmZmVyID0gbm90SW1wbGVtZW50ZWQ7XG5KU09OUHJvdG9jb2wucHJvdG90eXBlLnJlYWRSZWxheSA9IG5vdEltcGxlbWVudGVkO1xuXG5KU09OUHJvdG9jb2wucHJvdG90eXBlLnJlYWRSZWxheWVkT2ZmZXIgPSBub3RJbXBsZW1lbnRlZDtcbkpTT05Qcm90b2NvbC5wcm90b3R5cGUucmVhZFJlbGF5ZWRBbnN3ZXIgPSBub3RJbXBsZW1lbnRlZDtcbkpTT05Qcm90b2NvbC5wcm90b3R5cGUucmVhZFJlbGF5ZWRJY2VDYW5kaWRhdGUgPSBub3RJbXBsZW1lbnRlZDtcblxuSlNPTlByb3RvY29sLnByb3RvdHlwZS53cml0ZVJhdyA9IG5vdEltcGxlbWVudGVkO1xuXG5KU09OUHJvdG9jb2wucHJvdG90eXBlLndyaXRlUHJvdG9jb2xNZXNzYWdlID0gZnVuY3Rpb24obWVzc2FnZSl7XG5cdHZhciBzZXJpYWxpemVkTWVzc2FnZSA9IEpTT04uc3RyaW5naWZ5KG1lc3NhZ2UpO1xuXHR0aGlzLndyaXRlUmF3KHNlcmlhbGl6ZWRNZXNzYWdlKTtcbn07XG5cbkpTT05Qcm90b2NvbC5wcm90b3R5cGUud3JpdGVNZXNzYWdlID0gZnVuY3Rpb24obWVzc2FnZSl7XG5cdGlmKG1lc3NhZ2UgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcil7XG5cdFx0dGhpcy53cml0ZVJhdyhtZXNzYWdlKTtcblx0fSBlbHNlIHtcblx0XHR0aGlzLndyaXRlU3RyaW5nTWVzc2FnZShtZXNzYWdlKTtcblx0fVxufTtcblxuSlNPTlByb3RvY29sLnByb3RvdHlwZS53cml0ZVN0cmluZ01lc3NhZ2UgPSBmdW5jdGlvbihtZXNzYWdlKXtcblx0dGhpcy53cml0ZVByb3RvY29sTWVzc2FnZShbXG5cdFx0dGhpcy5NRVNTQUdFX1RZUEUuRElSRUNULFxuXHRcdG1lc3NhZ2Vcblx0XSk7XG59O1xuXG5KU09OUHJvdG9jb2wucHJvdG90eXBlLndyaXRlUmVsYXllZE1lc3NhZ2UgPSBmdW5jdGlvbihvcmlnaW4sIG1lc3NhZ2Upe1xuXHR0aGlzLndyaXRlUHJvdG9jb2xNZXNzYWdlKFtcblx0XHR0aGlzLk1FU1NBR0VfVFlQRS5SRUxBWUVELFxuXHRcdG9yaWdpbixcblx0XHRtZXNzYWdlXG5cdF0pO1xufTtcblxuSlNPTlByb3RvY29sLnByb3RvdHlwZS53cml0ZVJlbGF5TWVzc2FnZSA9IGZ1bmN0aW9uKGRlc3RpbmF0aW9uLCBtZXNzYWdlKXtcblx0dGhpcy53cml0ZVByb3RvY29sTWVzc2FnZShbXG5cdFx0dGhpcy5NRVNTQUdFX1RZUEUuUkVMQVksXG5cdFx0ZGVzdGluYXRpb24sXG5cdFx0bWVzc2FnZVxuXHRdKTtcbn07XG5cbkpTT05Qcm90b2NvbC5wcm90b3R5cGUud3JpdGVSZWxheUFuc3dlciA9IGZ1bmN0aW9uKGRlc3RpbmF0aW9uLCBkZXNjcmlwdGlvbil7XG5cdHRoaXMud3JpdGVSZWxheU1lc3NhZ2UoZGVzdGluYXRpb24sIFtcblx0XHR0aGlzLk1FU1NBR0VfVFlQRS5SVENfQU5TV0VSLFxuXHRcdGRlc2NyaXB0aW9uXG5cdF0pO1xufTtcblxuSlNPTlByb3RvY29sLnByb3RvdHlwZS53cml0ZVJlbGF5SWNlQ2FuZGlkYXRlID0gZnVuY3Rpb24oZGVzdGluYXRpb24sIGNhbmRpZGF0ZSl7XG5cdHRoaXMud3JpdGVSZWxheU1lc3NhZ2UoZGVzdGluYXRpb24sIFtcblx0XHR0aGlzLk1FU1NBR0VfVFlQRS5SVENfSUNFX0NBTkRJREFURSxcblx0XHRjYW5kaWRhdGVcblx0XSk7XG59O1xuXG5KU09OUHJvdG9jb2wucHJvdG90eXBlLndyaXRlUmVsYXlPZmZlciA9IGZ1bmN0aW9uKGRlc3RpbmF0aW9uLCBkZXNjcmlwdGlvbiwgZGF0YSl7XG5cdHRoaXMud3JpdGVSZWxheU1lc3NhZ2UoZGVzdGluYXRpb24sIFtcblx0XHR0aGlzLk1FU1NBR0VfVFlQRS5SVENfT0ZGRVIsXG5cdFx0ZGVzY3JpcHRpb24sXG5cdFx0ZGF0YVxuXHRdKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gSlNPTlByb3RvY29sOyIsInZhciBFbWl0dGVyID0gcmVxdWlyZSgnZXZlbnRzJykuRXZlbnRFbWl0dGVyLFxuXHRDb25uZWN0aW9uTWFuYWdlciA9IHJlcXVpcmUoJy4vQ29ubmVjdGlvbk1hbmFnZXIuanMnKSxcblx0V2ViU29ja2V0Q29ubmVjdGlvbiA9IHJlcXVpcmUoJy4vV2ViU29ja2V0Q29ubmVjdGlvbi5qcycpLFxuXHRpdHMgPSByZXF1aXJlKCdpdHMnKTtcblxucmVxdWlyZSgnLi9XZWJSdGNDb25uZWN0aW9uJyk7XG5cbmZ1bmN0aW9uIFAoZW1pdHRlciwgY29ubmVjdGlvbk1hbmFnZXIsIG9wdGlvbnMpe1xuXHRpdHMuZGVmaW5lZChlbWl0dGVyKTtcblx0aXRzLmRlZmluZWQoY29ubmVjdGlvbk1hbmFnZXIpO1xuXG5cdHRoaXMuZW1pdHRlciA9IGVtaXR0ZXI7XG5cdHRoaXMucGVlcnMgPSBjb25uZWN0aW9uTWFuYWdlcjtcblxuXHR0aGlzLnBlZXJzLm9uQWRkID0gZnVuY3Rpb24ocGVlcil7XG5cdFx0ZW1pdHRlci5lbWl0KCdjb25uZWN0aW9uJywgcGVlcik7XG5cdH07XG5cblx0dGhpcy5wZWVycy5vblJlbW92ZSA9IGZ1bmN0aW9uKHBlZXIpe1xuXHRcdGVtaXR0ZXIuZW1pdCgnZGlzY29ubmVjdGlvbicsIHBlZXIpO1xuXHR9O1xuXG5cdGlmKG9wdGlvbnMgJiYgb3B0aW9ucy5maXJld2FsbCkgdGhpcy5maXJld2FsbCA9IG9wdGlvbnMuZmlyZXdhbGw7XG59XG5cblAuY3JlYXRlID0gZnVuY3Rpb24ob3B0aW9ucyl7XG5cdHZhciBlbWl0dGVyID0gbmV3IEVtaXR0ZXIoKSxcblx0XHRjb25uZWN0aW9uTWFuYWdlciA9IG5ldyBDb25uZWN0aW9uTWFuYWdlcigpO1xuXG5cdHJldHVybiBuZXcgUChlbWl0dGVyLCBjb25uZWN0aW9uTWFuYWdlciwgb3B0aW9ucyk7XG59O1xuXG5QLnByb3RvdHlwZS5nZXRQZWVycyA9IGZ1bmN0aW9uKCl7XG5cdHJldHVybiB0aGlzLnBlZXJzLmdldCgpO1xufTtcblxuUC5wcm90b3R5cGUuY29ubmVjdCA9IGZ1bmN0aW9uKGFkZHJlc3Mpe1xuXHRpdHMuc3RyaW5nKGFkZHJlc3MpO1xuXG5cdHZhciBwZWVycyA9IHRoaXMucGVlcnMsXG5cdFx0cGVlciA9IFdlYlNvY2tldENvbm5lY3Rpb24uY3JlYXRlKGFkZHJlc3MsIHRoaXMucGVlcnMsIHtmaXJld2FsbDogdGhpcy5maXJld2FsbH0pO1xuXG5cdHBlZXJzLmFkZChwZWVyKTtcblxuXHRwZWVyLm9uKCdjbG9zZScsIGZ1bmN0aW9uKCl7XG5cdFx0cGVlcnMucmVtb3ZlKHBlZXIpO1xuXHR9KTtcblxuXHRyZXR1cm4gcGVlcjtcbn07XG5cblAucHJvdG90eXBlLm9uID0gZnVuY3Rpb24oKXtcblx0dGhpcy5lbWl0dGVyLm9uLmFwcGx5KHRoaXMuZW1pdHRlciwgYXJndW1lbnRzKTtcblx0cmV0dXJuIHRoaXM7XG59O1xuXG5QLnByb3RvdHlwZS5yZW1vdmVMaXN0ZW5lciA9IGZ1bmN0aW9uKCl7XG5cdHRoaXMuZW1pdHRlci5yZW1vdmVMaXN0ZW5lci5hcHBseSh0aGlzLmVtaXR0ZXIsIGFyZ3VtZW50cyk7XG5cdHJldHVybiB0aGlzO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBQO1xuIiwiLypnbG9iYWxcblx0XHRSVENQZWVyQ29ubmVjdGlvbixcblx0XHR3ZWJraXRSVENQZWVyQ29ubmVjdGlvbixcblx0XHRtb3pSVENQZWVyQ29ubmVjdGlvbixcblx0XHRSVENTZXNzaW9uRGVzY3JpcHRpb24sXG5cdFx0bW96UlRDU2Vzc2lvbkRlc2NyaXB0aW9uLFxuXHRcdFJUQ0ljZUNhbmRpZGF0ZSxcblx0XHRtb3pSVENJY2VDYW5kaWRhdGVcbiovXG5cbnZhciBDb25uZWN0aW9uID0gcmVxdWlyZSgnLi9Db25uZWN0aW9uLmpzJyksXG5cdGl0cyA9IHJlcXVpcmUoJ2l0cycpO1xuXG52YXIgbmF0aXZlUlRDUGVlckNvbm5lY3Rpb24gPSAodHlwZW9mIFJUQ1BlZXJDb25uZWN0aW9uICE9PSAndW5kZWZpbmVkJyk/IFJUQ1BlZXJDb25uZWN0aW9uIDpcblx0XHRcdFx0XHRcdFx0ICAodHlwZW9mIHdlYmtpdFJUQ1BlZXJDb25uZWN0aW9uICE9PSAndW5kZWZpbmVkJyk/IHdlYmtpdFJUQ1BlZXJDb25uZWN0aW9uIDpcblx0XHRcdFx0XHRcdFx0ICAodHlwZW9mIG1velJUQ1BlZXJDb25uZWN0aW9uICE9PSAndW5kZWZpbmVkJyk/IG1velJUQ1BlZXJDb25uZWN0aW9uIDpcblx0XHRcdFx0XHRcdFx0ICB1bmRlZmluZWQ7XG5cbnZhciBuYXRpdmVSVENTZXNzaW9uRGVzY3JpcHRpb24gPSAodHlwZW9mIFJUQ1Nlc3Npb25EZXNjcmlwdGlvbiAhPT0gJ3VuZGVmaW5lZCcpPyBSVENTZXNzaW9uRGVzY3JpcHRpb24gOlxuXHRcdFx0XHRcdFx0XHRcdCAgKHR5cGVvZiBtb3pSVENTZXNzaW9uRGVzY3JpcHRpb24gIT09ICd1bmRlZmluZWQnKT8gbW96UlRDU2Vzc2lvbkRlc2NyaXB0aW9uIDpcblx0XHRcdFx0XHRcdFx0XHQgIHVuZGVmaW5lZDtcbnZhciBuYXRpdmVSVENJY2VDYW5kaWRhdGUgPSAodHlwZW9mIFJUQ0ljZUNhbmRpZGF0ZSAhPT0gJ3VuZGVmaW5lZCcpPyBSVENJY2VDYW5kaWRhdGUgOlxuXHRcdFx0XHRcdFx0XHQodHlwZW9mIG1velJUQ0ljZUNhbmRpZGF0ZSAhPT0gJ3VuZGVmaW5lZCcpPyBtb3pSVENJY2VDYW5kaWRhdGUgOlxuXHRcdFx0XHRcdFx0XHR1bmRlZmluZWQ7XG5cbnZhciBsb2cgPSBmdW5jdGlvbigpe307XG5cbmlmKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5QX0RFQlVHR0lOR19FTkFCTEVEKXtcblx0bG9nID0gZnVuY3Rpb24obGFiZWwsIGV2ZW50LCBvYmope1xuXHRcdHdpbmRvdy5jb25zb2xlLmRlYnVnKGxhYmVsLCBldmVudCwgb2JqKTtcblx0fTtcbn1cblxuZnVuY3Rpb24gV2ViUlRDQ29ubmVjdGlvbihhZGRyZXNzLCBwZWVycywgcnRjQ29ubmVjdGlvbiwgc2lnbmFsaW5nQ2hhbm5lbCwgb3B0aW9ucyl7XG5cdHZhciBzZWxmID0gdGhpcztcblxuXHRpdHMuc3RyaW5nKGFkZHJlc3MpO1xuXHRpdHMuZGVmaW5lZChwZWVycyk7XG5cdGl0cy5kZWZpbmVkKHJ0Y0Nvbm5lY3Rpb24pO1xuXHRpdHMuZGVmaW5lZChzaWduYWxpbmdDaGFubmVsKTtcblxuXHRDb25uZWN0aW9uLmNhbGwodGhpcywgYWRkcmVzcywgcGVlcnMsIG9wdGlvbnMpO1xuXG5cdHRoaXMuc2lnbmFsaW5nQ2hhbm5lbCA9IHNpZ25hbGluZ0NoYW5uZWw7XG5cdHRoaXMucnRjQ29ubmVjdGlvbiA9IHJ0Y0Nvbm5lY3Rpb247XG5cdHRoaXMucnRjRGF0YUNoYW5uZWwgPSBydGNDb25uZWN0aW9uLmNyZWF0ZURhdGFDaGFubmVsKHRoaXMuUFJPVE9DT0xfTkFNRSwge3Byb3RvY29sOiB0aGlzLlBST1RPQ09MX05BTUV9KTtcblxuXG5cdC8vIEJ1ZyBpbiBGRiBzZWVtcyB0byBnYXJiYWdlIGNvbGxlY3QgdGhlIHN0YWxlIHJlZiBjYXVzaW5nIGl0IHRvIGNsb3NlXG5cdC8vIHRoZSBwcmV2ZW50cyBpdCBmcm9tIGJlaW5nIGxvc3QgaW4gYSBHQyBldmVudFxuXHR0aGlzLl9pbml0aWFsUnRjRGF0YUNoYW5uZWwgPSB0aGlzLnJ0Y0RhdGFDaGFubmVsO1xuXG5cblx0dGhpcy5jbG9zZSA9IHJ0Y0Nvbm5lY3Rpb24uY2xvc2UuYmluZChydGNDb25uZWN0aW9uKTtcblxuXHR0aGlzLnJ0Y0Nvbm5lY3Rpb24uYWRkRXZlbnRMaXN0ZW5lcignaWNlY2FuZGlkYXRlJywgZnVuY3Rpb24oZXZlbnQpe1xuXHRcdGlmKCFldmVudC5jYW5kaWRhdGUpIHJldHVybjtcblx0XHRsb2coJ2ljZSBjYW5kaWRhdGUnLCBldmVudCwgc2VsZik7XG5cdFx0c2VsZi5zaWduYWxpbmdDaGFubmVsLndyaXRlUmVsYXlJY2VDYW5kaWRhdGUoYWRkcmVzcywgZXZlbnQuY2FuZGlkYXRlKTtcblx0fSk7XG5cblx0dGhpcy5ydGNDb25uZWN0aW9uLmFkZEV2ZW50TGlzdGVuZXIoJ2RhdGFjaGFubmVsJywgZnVuY3Rpb24oZXZlbnQpe1xuXHRcdGxvZygnZGF0YWNoYW5uZWwnLCBldmVudCwgc2VsZik7XG5cblx0XHR2YXIgcnRjRGF0YUNoYW5uZWwgPSBzZWxmLnJ0Y0RhdGFDaGFubmVsID0gZXZlbnQuY2hhbm5lbDtcblx0XHRydGNEYXRhQ2hhbm5lbC5hZGRFdmVudExpc3RlbmVyKCdvcGVuJywgZnVuY3Rpb24oZXZlbnQpe1xuXHRcdFx0bG9nKCdyZW1vdGUgZGF0YWNoYW5uZWwgb3BlbicsIGV2ZW50LCBzZWxmKTtcblx0XHRcdHNlbGYuZW1pdHRlci5lbWl0KCdvcGVuJywgZXZlbnQpO1xuXHRcdH0pO1xuXG5cdFx0cnRjRGF0YUNoYW5uZWwuYWRkRXZlbnRMaXN0ZW5lcignY2xvc2UnLCBmdW5jdGlvbihldmVudCl7XG5cdFx0XHRsb2coJ3JlbW90ZSBkYXRhY2hhbm5lbCBjbG9zZScsIGV2ZW50LCBzZWxmKTtcblx0XHRcdHNlbGYuZW1pdHRlci5lbWl0KCdjbG9zZScsIGV2ZW50KTtcblx0XHR9KTtcblxuXHRcdHJ0Y0RhdGFDaGFubmVsLmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgZnVuY3Rpb24oZXZlbnQpe1xuXHRcdFx0bG9nKCdyZW1vdGUgZGF0YWNoYW5uZWwgZXJyb3InLCBldmVudCwgc2VsZik7XG5cdFx0XHRzZWxmLmVtaXR0ZXIuZW1pdCgnZXJyb3InLCBldmVudCk7XG5cdFx0fSk7XG5cdH0pO1xuXG5cdHRoaXMucnRjRGF0YUNoYW5uZWwuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uKG1lc3NhZ2Upe1xuXHRcdGxvZygnbG9jYWwgZGF0YWNoYW5uZWwgbWVzc2FnZScsIG1lc3NhZ2UsIHNlbGYpO1xuXHRcdHNlbGYucmVhZFJhdyhtZXNzYWdlLmRhdGEpO1xuXHR9KTtcblxuXHR0aGlzLnJ0Y0RhdGFDaGFubmVsLmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgZnVuY3Rpb24oZXZlbnQpe1xuXHRcdGxvZygnbG9jYWwgZGF0YWNoYW5uZWwgZXJyb3InLCBldmVudCwgc2VsZik7XG5cdFx0c2VsZi5lbWl0dGVyLmVtaXQoJ2Vycm9yJywgZXZlbnQpO1xuXHR9KTtcblxuXHR0aGlzLnJ0Y0RhdGFDaGFubmVsLmFkZEV2ZW50TGlzdGVuZXIoJ2Nsb3NlJywgZnVuY3Rpb24oZXZlbnQpe1xuXHRcdGxvZygnbG9jYWwgZGF0YWNoYW5uZWwgY2xvc2UnLCBldmVudCwgc2VsZik7XG5cdFx0c2VsZi5lbWl0dGVyLmVtaXQoJ2Nsb3NlJywgZXZlbnQpO1xuXHR9KTtcbn1cblxudmFyIERFRkFVTFRfUlRDX0NPTkZJR1VSQVRJT04gPSBudWxsO1xudmFyIERFRkFVTFRfUlRDX09GRkVSX09QVElPTlMgPSB7XG5cdG9mZmVyVG9SZWNlaXZlQXVkaW86IGZhbHNlLFxuXHRvZmZlclRvUmVjZWl2ZVZpZGVvOiBmYWxzZSxcblx0aWNlUmVzdGFydDogZmFsc2Vcbn07XG5cbi8vREVGQVVMVF9SVENfT0ZGRVJfT1BUSU9OU1xuV2ViUlRDQ29ubmVjdGlvbi5jcmVhdGUgPSBmdW5jdGlvbihjb25maWcsIHBlZXJzLCBzaWduYWxpbmdDaGFubmVsLCBvcHRpb25zKXtcblx0dmFyIHJ0Y0NvbmZpZ3VyYXRpb24gPSBjb25maWcucnRjQ29uZmlndXJhdGlvbiB8fCBERUZBVUxUX1JUQ19DT05GSUdVUkFUSU9OLFxuXHRcdHJ0Y0Nvbm5lY3Rpb24gPSBuZXcgbmF0aXZlUlRDUGVlckNvbm5lY3Rpb24ocnRjQ29uZmlndXJhdGlvbik7XG5cblx0cmV0dXJuIG5ldyBXZWJSVENDb25uZWN0aW9uKGNvbmZpZy5hZGRyZXNzLCBwZWVycywgcnRjQ29ubmVjdGlvbiwgc2lnbmFsaW5nQ2hhbm5lbCwgb3B0aW9ucyk7XG59O1xuXG5XZWJSVENDb25uZWN0aW9uLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoQ29ubmVjdGlvbi5wcm90b3R5cGUpO1xuXG5XZWJSVENDb25uZWN0aW9uLnByb3RvdHlwZS53cml0ZVJhdyA9IGZ1bmN0aW9uKG1lc3NhZ2Upe1xuXHRzd2l0Y2godGhpcy5ydGNEYXRhQ2hhbm5lbC5yZWFkeVN0YXRlKXtcblx0XHRjYXNlICdjb25uZWN0aW5nJzpcblx0XHRcdHRocm93IG5ldyBFcnJvcignQ2FuXFwndCBzZW5kIGEgbWVzc2FnZSB3aGlsZSBSVENEYXRhQ2hhbm5lbCBjb25uZWN0aW5nJyk7XG5cdFx0Y2FzZSAnb3Blbic6XG5cdFx0XHR0aGlzLnJ0Y0RhdGFDaGFubmVsLnNlbmQobWVzc2FnZSk7XG5cdFx0XHRsb2coJ3NlbnQgbWVzc2FnZSB0byByZW1vdGUnLCBtZXNzYWdlLCB0aGlzKTtcblx0XHRcdGJyZWFrO1xuXHRcdGNhc2UgJ2Nsb3NpbmcnOlxuXHRcdGNhc2UgJ2Nsb3NlZCc6XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoJ0NhblxcJ3Qgc2VuZCBhIG1lc3NhZ2Ugd2hpbGUgUlRDRGF0YUNoYW5uZWwgaXMgY2xvc2luZyBvciBjbG9zZWQnKTtcblx0fVxufTtcblxuV2ViUlRDQ29ubmVjdGlvbi5wcm90b3R5cGUucmVhZEFuc3dlciA9IGZ1bmN0aW9uKGRlc2NyaXB0aW9uKXtcblx0dmFyIHJ0Y1Nlc3Npb25EZXNjcmlwdGlvbiA9IG5ldyBuYXRpdmVSVENTZXNzaW9uRGVzY3JpcHRpb24oZGVzY3JpcHRpb24pO1xuXG5cdHRoaXMucnRjQ29ubmVjdGlvbi5zZXRSZW1vdGVEZXNjcmlwdGlvbihydGNTZXNzaW9uRGVzY3JpcHRpb24pO1xufTtcblxuV2ViUlRDQ29ubmVjdGlvbi5wcm90b3R5cGUucmVhZE9mZmVyID0gZnVuY3Rpb24oZGVzY3JpcHRpb24pe1xuXHR2YXIgcnRjU2Vzc2lvbkRlc2NyaXB0aW9uID0gbmV3IG5hdGl2ZVJUQ1Nlc3Npb25EZXNjcmlwdGlvbihkZXNjcmlwdGlvbik7XG5cdHRoaXMucnRjQ29ubmVjdGlvbi5zZXRSZW1vdGVEZXNjcmlwdGlvbihydGNTZXNzaW9uRGVzY3JpcHRpb24pO1xufTtcblxuV2ViUlRDQ29ubmVjdGlvbi5wcm90b3R5cGUucmVhZEljZUNhbmRpZGF0ZSA9IGZ1bmN0aW9uKGNhbmRpZGF0ZSl7XG5cdHRoaXMucnRjQ29ubmVjdGlvbi5hZGRJY2VDYW5kaWRhdGUobmV3IG5hdGl2ZVJUQ0ljZUNhbmRpZGF0ZShjYW5kaWRhdGUpKTtcbn07XG5cbldlYlJUQ0Nvbm5lY3Rpb24ucHJvdG90eXBlLndyaXRlQW5zd2VyID0gZnVuY3Rpb24oKXtcblx0dmFyIGVtaXR0ZXIgPSB0aGlzLmVtaXR0ZXIsXG5cdFx0YWRkcmVzcyA9IHRoaXMuYWRkcmVzcyxcblx0XHRydGNDb25uZWN0aW9uID0gdGhpcy5ydGNDb25uZWN0aW9uLFxuXHRcdHNpZ25hbGluZ0NoYW5uZWwgPSB0aGlzLnNpZ25hbGluZ0NoYW5uZWw7XG5cblx0ZnVuY3Rpb24gb25FcnJvcihlcnIpeyBlbWl0dGVyLmVtaXQoJ2Vycm9yJywgZXJyKTsgfVxuXG5cdHJ0Y0Nvbm5lY3Rpb24uY3JlYXRlQW5zd2VyKGZ1bmN0aW9uKGRlc2NyaXB0aW9uKXtcblx0XHRydGNDb25uZWN0aW9uLnNldExvY2FsRGVzY3JpcHRpb24oZGVzY3JpcHRpb24sIGZ1bmN0aW9uKCl7XG5cdFx0XHRzaWduYWxpbmdDaGFubmVsLndyaXRlUmVsYXlBbnN3ZXIoYWRkcmVzcywgZGVzY3JpcHRpb24pO1xuXHRcdH0sIG9uRXJyb3IpO1xuXHR9LCBvbkVycm9yKTtcbn07XG5cbldlYlJUQ0Nvbm5lY3Rpb24ucHJvdG90eXBlLndyaXRlT2ZmZXIgPSBmdW5jdGlvbihjb25maWcpe1xuXHR2YXIgZW1pdHRlciA9IHRoaXMuZW1pdHRlcixcblx0XHRhZGRyZXNzID0gdGhpcy5hZGRyZXNzLFxuXHRcdHJ0Y0Nvbm5lY3Rpb24gPSB0aGlzLnJ0Y0Nvbm5lY3Rpb24sXG5cdFx0c2lnbmFsaW5nQ2hhbm5lbCA9IHRoaXMuc2lnbmFsaW5nQ2hhbm5lbDtcblxuXHRmdW5jdGlvbiBvbkVycm9yKGVycil7IGVtaXR0ZXIuZW1pdCgnZXJyb3InLCBlcnIpOyB9XG5cblx0cnRjQ29ubmVjdGlvbi5jcmVhdGVPZmZlcihmdW5jdGlvbihkZXNjcmlwdGlvbil7XG5cdFx0cnRjQ29ubmVjdGlvbi5zZXRMb2NhbERlc2NyaXB0aW9uKGRlc2NyaXB0aW9uLCBmdW5jdGlvbigpe1xuXHRcdFx0c2lnbmFsaW5nQ2hhbm5lbC53cml0ZVJlbGF5T2ZmZXIoYWRkcmVzcywgZGVzY3JpcHRpb24sIGNvbmZpZy5vZmZlckRhdGEpO1xuXHRcdH0sIG9uRXJyb3IpO1xuXHR9LCBvbkVycm9yLCBjb25maWcucnRjT2ZmZXJPcHRpb25zIHx8IERFRkFVTFRfUlRDX09GRkVSX09QVElPTlMpO1xufTtcblxuV2ViUlRDQ29ubmVjdGlvbi5wcm90b3R5cGUuZ2V0UmVhZHlTdGF0ZSA9IGZ1bmN0aW9uKCl7XG5cdHJldHVybiB0aGlzLnJ0Y0RhdGFDaGFubmVsLnJlYWR5U3RhdGU7XG59O1xuXG4vLyBTb2x2ZXMgdGhlIGNpcmN1bGFyIGRlcGVuZGVuY3kgd2l0aCBDb25uZWN0aW9uLmpzXG5Db25uZWN0aW9uLmNyZWF0ZVdlYlJUQ0Nvbm5lY3Rpb24gPSBXZWJSVENDb25uZWN0aW9uLmNyZWF0ZTtcblxubW9kdWxlLmV4cG9ydHMgPSBXZWJSVENDb25uZWN0aW9uO1xuIiwidmFyIENvbm5lY3Rpb24gPSByZXF1aXJlKCcuL0Nvbm5lY3Rpb24uanMnKTtcblxudmFyIFdlYlNvY2tldFN0YXRlID0ge1xuXHRDT05ORUNUSU5HOiAwLFxuXHRPUEVOOiAxLFxuXHRDTE9TSU5HOiAyLFxuXHRDTE9TRUQ6IDNcbn07XG5cbmlmKHR5cGVvZiBXZWJTb2NrZXQgIT09ICd1bmRlZmluZWQnKXtcblx0V2ViU29ja2V0U3RhdGUgPSBXZWJTb2NrZXQ7XG59XG5cbmZ1bmN0aW9uIFdlYlNvY2tldENvbm5lY3Rpb24oYWRkcmVzcywgcGVlcnMsIHdlYlNvY2tldCwgb3B0aW9ucyl7XG5cdHZhciBzZWxmID0gdGhpcztcblxuXHRDb25uZWN0aW9uLmNhbGwodGhpcywgYWRkcmVzcywgcGVlcnMsIG9wdGlvbnMpO1xuXG5cdHRoaXMud2ViU29ja2V0ID0gd2ViU29ja2V0O1xuXG5cdHRoaXMuY2xvc2UgPSB3ZWJTb2NrZXQuY2xvc2UuYmluZCh3ZWJTb2NrZXQpO1xuXG5cdHRoaXMud2ViU29ja2V0LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBmdW5jdGlvbihtZXNzYWdlKXtcblx0XHRzZWxmLnJlYWRSYXcobWVzc2FnZS5kYXRhKTtcblx0fSk7XG5cblx0dGhpcy53ZWJTb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcignb3BlbicsIGZ1bmN0aW9uKGV2ZW50KXtcblx0XHRzZWxmLmVtaXR0ZXIuZW1pdCgnb3BlbicsIGV2ZW50KTtcblx0fSk7XG5cblx0dGhpcy53ZWJTb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCBmdW5jdGlvbihldmVudCl7XG5cdFx0c2VsZi5lbWl0dGVyLmVtaXQoJ2Vycm9yJywgZXZlbnQpO1xuXHR9KTtcblxuXHR0aGlzLndlYlNvY2tldC5hZGRFdmVudExpc3RlbmVyKCdjbG9zZScsIGZ1bmN0aW9uKGV2ZW50KXtcblx0XHRzZWxmLmVtaXR0ZXIuZW1pdCgnY2xvc2UnLCBldmVudCk7XG5cdH0pO1xufVxuXG5XZWJTb2NrZXRDb25uZWN0aW9uLmNyZWF0ZSA9IGZ1bmN0aW9uKGFkZHJlc3MsIHBlZXJzLCBvcHRpb25zKXtcblx0dmFyIHdlYlNvY2tldCA9IG5ldyBXZWJTb2NrZXQoYWRkcmVzcywgV2ViU29ja2V0Q29ubmVjdGlvbi5wcm90b3R5cGUuUFJPVE9DT0xfTkFNRSk7XG5cdHJldHVybiBuZXcgV2ViU29ja2V0Q29ubmVjdGlvbihhZGRyZXNzLCBwZWVycywgd2ViU29ja2V0LCBvcHRpb25zKTtcbn07XG5cbldlYlNvY2tldENvbm5lY3Rpb24ucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShDb25uZWN0aW9uLnByb3RvdHlwZSk7XG5XZWJTb2NrZXRDb25uZWN0aW9uLnByb3RvdHlwZS53cml0ZVJhdyA9IGZ1bmN0aW9uKG1lc3NhZ2Upe1xuXHRzd2l0Y2godGhpcy53ZWJTb2NrZXQucmVhZHlTdGF0ZSl7XG5cdFx0Y2FzZSBXZWJTb2NrZXRTdGF0ZS5DT05ORUNUSU5HOlxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKCdDYW5cXCd0IHNlbmQgYSBtZXNzYWdlIHdoaWxlIFdlYlNvY2tldCBjb25uZWN0aW5nJyk7XG5cblx0XHRjYXNlIFdlYlNvY2tldFN0YXRlLk9QRU46XG5cdFx0XHR0aGlzLndlYlNvY2tldC5zZW5kKG1lc3NhZ2UpO1xuXHRcdFx0YnJlYWs7XG5cblx0XHRjYXNlIFdlYlNvY2tldFN0YXRlLkNMT1NJTkc6XG5cdFx0Y2FzZSBXZWJTb2NrZXRTdGF0ZS5DTE9TRUQ6XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoJ0NhblxcJ3Qgc2VuZCBhIG1lc3NhZ2Ugd2hpbGUgV2ViU29ja2V0IGlzIGNsb3Npbmcgb3IgY2xvc2VkJyk7XG5cdH1cbn07XG5cbldlYlNvY2tldENvbm5lY3Rpb24ucHJvdG90eXBlLmdldFJlYWR5U3RhdGUgPSBmdW5jdGlvbigpe1xuXHRzd2l0Y2godGhpcy53ZWJTb2NrZXQucmVhZHlTdGF0ZSl7XG5cdFx0Y2FzZSBXZWJTb2NrZXRTdGF0ZS5DT05ORUNUSU5HOlxuXHRcdFx0cmV0dXJuICdjb25uZWN0aW5nJztcblx0XHRjYXNlIFdlYlNvY2tldFN0YXRlLk9QRU46XG5cdFx0XHRyZXR1cm4gJ29wZW4nO1xuXHRcdGNhc2UgV2ViU29ja2V0U3RhdGUuQ0xPU0lORzpcblx0XHRcdHJldHVybiAnY2xvc2luZyc7XG5cdFx0Y2FzZSBXZWJTb2NrZXRTdGF0ZS5DTE9TRUQ6XG5cdFx0XHRyZXR1cm4gJ2Nsb3NlZCc7XG5cdH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gV2ViU29ja2V0Q29ubmVjdGlvbjtcbiIsIi8vIENvcHlyaWdodCBKb3llbnQsIEluYy4gYW5kIG90aGVyIE5vZGUgY29udHJpYnV0b3JzLlxuLy9cbi8vIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhXG4vLyBjb3B5IG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlXG4vLyBcIlNvZnR3YXJlXCIpLCB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmdcbi8vIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCxcbi8vIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXRcbi8vIHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZVxuLy8gZm9sbG93aW5nIGNvbmRpdGlvbnM6XG4vL1xuLy8gVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWRcbi8vIGluIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuLy9cbi8vIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1Ncbi8vIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0Zcbi8vIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU5cbi8vIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLFxuLy8gREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SXG4vLyBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFXG4vLyBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLlxuXG5mdW5jdGlvbiBFdmVudEVtaXR0ZXIoKSB7XG4gIHRoaXMuX2V2ZW50cyA9IHRoaXMuX2V2ZW50cyB8fCB7fTtcbiAgdGhpcy5fbWF4TGlzdGVuZXJzID0gdGhpcy5fbWF4TGlzdGVuZXJzIHx8IHVuZGVmaW5lZDtcbn1cbm1vZHVsZS5leHBvcnRzID0gRXZlbnRFbWl0dGVyO1xuXG4vLyBCYWNrd2FyZHMtY29tcGF0IHdpdGggbm9kZSAwLjEwLnhcbkV2ZW50RW1pdHRlci5FdmVudEVtaXR0ZXIgPSBFdmVudEVtaXR0ZXI7XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUuX2V2ZW50cyA9IHVuZGVmaW5lZDtcbkV2ZW50RW1pdHRlci5wcm90b3R5cGUuX21heExpc3RlbmVycyA9IHVuZGVmaW5lZDtcblxuLy8gQnkgZGVmYXVsdCBFdmVudEVtaXR0ZXJzIHdpbGwgcHJpbnQgYSB3YXJuaW5nIGlmIG1vcmUgdGhhbiAxMCBsaXN0ZW5lcnMgYXJlXG4vLyBhZGRlZCB0byBpdC4gVGhpcyBpcyBhIHVzZWZ1bCBkZWZhdWx0IHdoaWNoIGhlbHBzIGZpbmRpbmcgbWVtb3J5IGxlYWtzLlxuRXZlbnRFbWl0dGVyLmRlZmF1bHRNYXhMaXN0ZW5lcnMgPSAxMDtcblxuLy8gT2J2aW91c2x5IG5vdCBhbGwgRW1pdHRlcnMgc2hvdWxkIGJlIGxpbWl0ZWQgdG8gMTAuIFRoaXMgZnVuY3Rpb24gYWxsb3dzXG4vLyB0aGF0IHRvIGJlIGluY3JlYXNlZC4gU2V0IHRvIHplcm8gZm9yIHVubGltaXRlZC5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUuc2V0TWF4TGlzdGVuZXJzID0gZnVuY3Rpb24obikge1xuICBpZiAoIWlzTnVtYmVyKG4pIHx8IG4gPCAwIHx8IGlzTmFOKG4pKVxuICAgIHRocm93IFR5cGVFcnJvcignbiBtdXN0IGJlIGEgcG9zaXRpdmUgbnVtYmVyJyk7XG4gIHRoaXMuX21heExpc3RlbmVycyA9IG47XG4gIHJldHVybiB0aGlzO1xufTtcblxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5lbWl0ID0gZnVuY3Rpb24odHlwZSkge1xuICB2YXIgZXIsIGhhbmRsZXIsIGxlbiwgYXJncywgaSwgbGlzdGVuZXJzO1xuXG4gIGlmICghdGhpcy5fZXZlbnRzKVxuICAgIHRoaXMuX2V2ZW50cyA9IHt9O1xuXG4gIC8vIElmIHRoZXJlIGlzIG5vICdlcnJvcicgZXZlbnQgbGlzdGVuZXIgdGhlbiB0aHJvdy5cbiAgaWYgKHR5cGUgPT09ICdlcnJvcicpIHtcbiAgICBpZiAoIXRoaXMuX2V2ZW50cy5lcnJvciB8fFxuICAgICAgICAoaXNPYmplY3QodGhpcy5fZXZlbnRzLmVycm9yKSAmJiAhdGhpcy5fZXZlbnRzLmVycm9yLmxlbmd0aCkpIHtcbiAgICAgIGVyID0gYXJndW1lbnRzWzFdO1xuICAgICAgaWYgKGVyIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgICAgdGhyb3cgZXI7IC8vIFVuaGFuZGxlZCAnZXJyb3InIGV2ZW50XG4gICAgICB9XG4gICAgICB0aHJvdyBUeXBlRXJyb3IoJ1VuY2F1Z2h0LCB1bnNwZWNpZmllZCBcImVycm9yXCIgZXZlbnQuJyk7XG4gICAgfVxuICB9XG5cbiAgaGFuZGxlciA9IHRoaXMuX2V2ZW50c1t0eXBlXTtcblxuICBpZiAoaXNVbmRlZmluZWQoaGFuZGxlcikpXG4gICAgcmV0dXJuIGZhbHNlO1xuXG4gIGlmIChpc0Z1bmN0aW9uKGhhbmRsZXIpKSB7XG4gICAgc3dpdGNoIChhcmd1bWVudHMubGVuZ3RoKSB7XG4gICAgICAvLyBmYXN0IGNhc2VzXG4gICAgICBjYXNlIDE6XG4gICAgICAgIGhhbmRsZXIuY2FsbCh0aGlzKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGhhbmRsZXIuY2FsbCh0aGlzLCBhcmd1bWVudHNbMV0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgaGFuZGxlci5jYWxsKHRoaXMsIGFyZ3VtZW50c1sxXSwgYXJndW1lbnRzWzJdKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICAvLyBzbG93ZXJcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gICAgICAgIGFyZ3MgPSBuZXcgQXJyYXkobGVuIC0gMSk7XG4gICAgICAgIGZvciAoaSA9IDE7IGkgPCBsZW47IGkrKylcbiAgICAgICAgICBhcmdzW2kgLSAxXSA9IGFyZ3VtZW50c1tpXTtcbiAgICAgICAgaGFuZGxlci5hcHBseSh0aGlzLCBhcmdzKTtcbiAgICB9XG4gIH0gZWxzZSBpZiAoaXNPYmplY3QoaGFuZGxlcikpIHtcbiAgICBsZW4gPSBhcmd1bWVudHMubGVuZ3RoO1xuICAgIGFyZ3MgPSBuZXcgQXJyYXkobGVuIC0gMSk7XG4gICAgZm9yIChpID0gMTsgaSA8IGxlbjsgaSsrKVxuICAgICAgYXJnc1tpIC0gMV0gPSBhcmd1bWVudHNbaV07XG5cbiAgICBsaXN0ZW5lcnMgPSBoYW5kbGVyLnNsaWNlKCk7XG4gICAgbGVuID0gbGlzdGVuZXJzLmxlbmd0aDtcbiAgICBmb3IgKGkgPSAwOyBpIDwgbGVuOyBpKyspXG4gICAgICBsaXN0ZW5lcnNbaV0uYXBwbHkodGhpcywgYXJncyk7XG4gIH1cblxuICByZXR1cm4gdHJ1ZTtcbn07XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUuYWRkTGlzdGVuZXIgPSBmdW5jdGlvbih0eXBlLCBsaXN0ZW5lcikge1xuICB2YXIgbTtcblxuICBpZiAoIWlzRnVuY3Rpb24obGlzdGVuZXIpKVxuICAgIHRocm93IFR5cGVFcnJvcignbGlzdGVuZXIgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7XG5cbiAgaWYgKCF0aGlzLl9ldmVudHMpXG4gICAgdGhpcy5fZXZlbnRzID0ge307XG5cbiAgLy8gVG8gYXZvaWQgcmVjdXJzaW9uIGluIHRoZSBjYXNlIHRoYXQgdHlwZSA9PT0gXCJuZXdMaXN0ZW5lclwiISBCZWZvcmVcbiAgLy8gYWRkaW5nIGl0IHRvIHRoZSBsaXN0ZW5lcnMsIGZpcnN0IGVtaXQgXCJuZXdMaXN0ZW5lclwiLlxuICBpZiAodGhpcy5fZXZlbnRzLm5ld0xpc3RlbmVyKVxuICAgIHRoaXMuZW1pdCgnbmV3TGlzdGVuZXInLCB0eXBlLFxuICAgICAgICAgICAgICBpc0Z1bmN0aW9uKGxpc3RlbmVyLmxpc3RlbmVyKSA/XG4gICAgICAgICAgICAgIGxpc3RlbmVyLmxpc3RlbmVyIDogbGlzdGVuZXIpO1xuXG4gIGlmICghdGhpcy5fZXZlbnRzW3R5cGVdKVxuICAgIC8vIE9wdGltaXplIHRoZSBjYXNlIG9mIG9uZSBsaXN0ZW5lci4gRG9uJ3QgbmVlZCB0aGUgZXh0cmEgYXJyYXkgb2JqZWN0LlxuICAgIHRoaXMuX2V2ZW50c1t0eXBlXSA9IGxpc3RlbmVyO1xuICBlbHNlIGlmIChpc09iamVjdCh0aGlzLl9ldmVudHNbdHlwZV0pKVxuICAgIC8vIElmIHdlJ3ZlIGFscmVhZHkgZ290IGFuIGFycmF5LCBqdXN0IGFwcGVuZC5cbiAgICB0aGlzLl9ldmVudHNbdHlwZV0ucHVzaChsaXN0ZW5lcik7XG4gIGVsc2VcbiAgICAvLyBBZGRpbmcgdGhlIHNlY29uZCBlbGVtZW50LCBuZWVkIHRvIGNoYW5nZSB0byBhcnJheS5cbiAgICB0aGlzLl9ldmVudHNbdHlwZV0gPSBbdGhpcy5fZXZlbnRzW3R5cGVdLCBsaXN0ZW5lcl07XG5cbiAgLy8gQ2hlY2sgZm9yIGxpc3RlbmVyIGxlYWtcbiAgaWYgKGlzT2JqZWN0KHRoaXMuX2V2ZW50c1t0eXBlXSkgJiYgIXRoaXMuX2V2ZW50c1t0eXBlXS53YXJuZWQpIHtcbiAgICB2YXIgbTtcbiAgICBpZiAoIWlzVW5kZWZpbmVkKHRoaXMuX21heExpc3RlbmVycykpIHtcbiAgICAgIG0gPSB0aGlzLl9tYXhMaXN0ZW5lcnM7XG4gICAgfSBlbHNlIHtcbiAgICAgIG0gPSBFdmVudEVtaXR0ZXIuZGVmYXVsdE1heExpc3RlbmVycztcbiAgICB9XG5cbiAgICBpZiAobSAmJiBtID4gMCAmJiB0aGlzLl9ldmVudHNbdHlwZV0ubGVuZ3RoID4gbSkge1xuICAgICAgdGhpcy5fZXZlbnRzW3R5cGVdLndhcm5lZCA9IHRydWU7XG4gICAgICBjb25zb2xlLmVycm9yKCcobm9kZSkgd2FybmluZzogcG9zc2libGUgRXZlbnRFbWl0dGVyIG1lbW9yeSAnICtcbiAgICAgICAgICAgICAgICAgICAgJ2xlYWsgZGV0ZWN0ZWQuICVkIGxpc3RlbmVycyBhZGRlZC4gJyArXG4gICAgICAgICAgICAgICAgICAgICdVc2UgZW1pdHRlci5zZXRNYXhMaXN0ZW5lcnMoKSB0byBpbmNyZWFzZSBsaW1pdC4nLFxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9ldmVudHNbdHlwZV0ubGVuZ3RoKTtcbiAgICAgIGlmICh0eXBlb2YgY29uc29sZS50cmFjZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAvLyBub3Qgc3VwcG9ydGVkIGluIElFIDEwXG4gICAgICAgIGNvbnNvbGUudHJhY2UoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gdGhpcztcbn07XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUub24gPSBFdmVudEVtaXR0ZXIucHJvdG90eXBlLmFkZExpc3RlbmVyO1xuXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLm9uY2UgPSBmdW5jdGlvbih0eXBlLCBsaXN0ZW5lcikge1xuICBpZiAoIWlzRnVuY3Rpb24obGlzdGVuZXIpKVxuICAgIHRocm93IFR5cGVFcnJvcignbGlzdGVuZXIgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7XG5cbiAgdmFyIGZpcmVkID0gZmFsc2U7XG5cbiAgZnVuY3Rpb24gZygpIHtcbiAgICB0aGlzLnJlbW92ZUxpc3RlbmVyKHR5cGUsIGcpO1xuXG4gICAgaWYgKCFmaXJlZCkge1xuICAgICAgZmlyZWQgPSB0cnVlO1xuICAgICAgbGlzdGVuZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9XG4gIH1cblxuICBnLmxpc3RlbmVyID0gbGlzdGVuZXI7XG4gIHRoaXMub24odHlwZSwgZyk7XG5cbiAgcmV0dXJuIHRoaXM7XG59O1xuXG4vLyBlbWl0cyBhICdyZW1vdmVMaXN0ZW5lcicgZXZlbnQgaWZmIHRoZSBsaXN0ZW5lciB3YXMgcmVtb3ZlZFxuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5yZW1vdmVMaXN0ZW5lciA9IGZ1bmN0aW9uKHR5cGUsIGxpc3RlbmVyKSB7XG4gIHZhciBsaXN0LCBwb3NpdGlvbiwgbGVuZ3RoLCBpO1xuXG4gIGlmICghaXNGdW5jdGlvbihsaXN0ZW5lcikpXG4gICAgdGhyb3cgVHlwZUVycm9yKCdsaXN0ZW5lciBtdXN0IGJlIGEgZnVuY3Rpb24nKTtcblxuICBpZiAoIXRoaXMuX2V2ZW50cyB8fCAhdGhpcy5fZXZlbnRzW3R5cGVdKVxuICAgIHJldHVybiB0aGlzO1xuXG4gIGxpc3QgPSB0aGlzLl9ldmVudHNbdHlwZV07XG4gIGxlbmd0aCA9IGxpc3QubGVuZ3RoO1xuICBwb3NpdGlvbiA9IC0xO1xuXG4gIGlmIChsaXN0ID09PSBsaXN0ZW5lciB8fFxuICAgICAgKGlzRnVuY3Rpb24obGlzdC5saXN0ZW5lcikgJiYgbGlzdC5saXN0ZW5lciA9PT0gbGlzdGVuZXIpKSB7XG4gICAgZGVsZXRlIHRoaXMuX2V2ZW50c1t0eXBlXTtcbiAgICBpZiAodGhpcy5fZXZlbnRzLnJlbW92ZUxpc3RlbmVyKVxuICAgICAgdGhpcy5lbWl0KCdyZW1vdmVMaXN0ZW5lcicsIHR5cGUsIGxpc3RlbmVyKTtcblxuICB9IGVsc2UgaWYgKGlzT2JqZWN0KGxpc3QpKSB7XG4gICAgZm9yIChpID0gbGVuZ3RoOyBpLS0gPiAwOykge1xuICAgICAgaWYgKGxpc3RbaV0gPT09IGxpc3RlbmVyIHx8XG4gICAgICAgICAgKGxpc3RbaV0ubGlzdGVuZXIgJiYgbGlzdFtpXS5saXN0ZW5lciA9PT0gbGlzdGVuZXIpKSB7XG4gICAgICAgIHBvc2l0aW9uID0gaTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHBvc2l0aW9uIDwgMClcbiAgICAgIHJldHVybiB0aGlzO1xuXG4gICAgaWYgKGxpc3QubGVuZ3RoID09PSAxKSB7XG4gICAgICBsaXN0Lmxlbmd0aCA9IDA7XG4gICAgICBkZWxldGUgdGhpcy5fZXZlbnRzW3R5cGVdO1xuICAgIH0gZWxzZSB7XG4gICAgICBsaXN0LnNwbGljZShwb3NpdGlvbiwgMSk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuX2V2ZW50cy5yZW1vdmVMaXN0ZW5lcilcbiAgICAgIHRoaXMuZW1pdCgncmVtb3ZlTGlzdGVuZXInLCB0eXBlLCBsaXN0ZW5lcik7XG4gIH1cblxuICByZXR1cm4gdGhpcztcbn07XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUucmVtb3ZlQWxsTGlzdGVuZXJzID0gZnVuY3Rpb24odHlwZSkge1xuICB2YXIga2V5LCBsaXN0ZW5lcnM7XG5cbiAgaWYgKCF0aGlzLl9ldmVudHMpXG4gICAgcmV0dXJuIHRoaXM7XG5cbiAgLy8gbm90IGxpc3RlbmluZyBmb3IgcmVtb3ZlTGlzdGVuZXIsIG5vIG5lZWQgdG8gZW1pdFxuICBpZiAoIXRoaXMuX2V2ZW50cy5yZW1vdmVMaXN0ZW5lcikge1xuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKVxuICAgICAgdGhpcy5fZXZlbnRzID0ge307XG4gICAgZWxzZSBpZiAodGhpcy5fZXZlbnRzW3R5cGVdKVxuICAgICAgZGVsZXRlIHRoaXMuX2V2ZW50c1t0eXBlXTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8vIGVtaXQgcmVtb3ZlTGlzdGVuZXIgZm9yIGFsbCBsaXN0ZW5lcnMgb24gYWxsIGV2ZW50c1xuICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgIGZvciAoa2V5IGluIHRoaXMuX2V2ZW50cykge1xuICAgICAgaWYgKGtleSA9PT0gJ3JlbW92ZUxpc3RlbmVyJykgY29udGludWU7XG4gICAgICB0aGlzLnJlbW92ZUFsbExpc3RlbmVycyhrZXkpO1xuICAgIH1cbiAgICB0aGlzLnJlbW92ZUFsbExpc3RlbmVycygncmVtb3ZlTGlzdGVuZXInKTtcbiAgICB0aGlzLl9ldmVudHMgPSB7fTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGxpc3RlbmVycyA9IHRoaXMuX2V2ZW50c1t0eXBlXTtcblxuICBpZiAoaXNGdW5jdGlvbihsaXN0ZW5lcnMpKSB7XG4gICAgdGhpcy5yZW1vdmVMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcnMpO1xuICB9IGVsc2Uge1xuICAgIC8vIExJRk8gb3JkZXJcbiAgICB3aGlsZSAobGlzdGVuZXJzLmxlbmd0aClcbiAgICAgIHRoaXMucmVtb3ZlTGlzdGVuZXIodHlwZSwgbGlzdGVuZXJzW2xpc3RlbmVycy5sZW5ndGggLSAxXSk7XG4gIH1cbiAgZGVsZXRlIHRoaXMuX2V2ZW50c1t0eXBlXTtcblxuICByZXR1cm4gdGhpcztcbn07XG5cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUubGlzdGVuZXJzID0gZnVuY3Rpb24odHlwZSkge1xuICB2YXIgcmV0O1xuICBpZiAoIXRoaXMuX2V2ZW50cyB8fCAhdGhpcy5fZXZlbnRzW3R5cGVdKVxuICAgIHJldCA9IFtdO1xuICBlbHNlIGlmIChpc0Z1bmN0aW9uKHRoaXMuX2V2ZW50c1t0eXBlXSkpXG4gICAgcmV0ID0gW3RoaXMuX2V2ZW50c1t0eXBlXV07XG4gIGVsc2VcbiAgICByZXQgPSB0aGlzLl9ldmVudHNbdHlwZV0uc2xpY2UoKTtcbiAgcmV0dXJuIHJldDtcbn07XG5cbkV2ZW50RW1pdHRlci5saXN0ZW5lckNvdW50ID0gZnVuY3Rpb24oZW1pdHRlciwgdHlwZSkge1xuICB2YXIgcmV0O1xuICBpZiAoIWVtaXR0ZXIuX2V2ZW50cyB8fCAhZW1pdHRlci5fZXZlbnRzW3R5cGVdKVxuICAgIHJldCA9IDA7XG4gIGVsc2UgaWYgKGlzRnVuY3Rpb24oZW1pdHRlci5fZXZlbnRzW3R5cGVdKSlcbiAgICByZXQgPSAxO1xuICBlbHNlXG4gICAgcmV0ID0gZW1pdHRlci5fZXZlbnRzW3R5cGVdLmxlbmd0aDtcbiAgcmV0dXJuIHJldDtcbn07XG5cbmZ1bmN0aW9uIGlzRnVuY3Rpb24oYXJnKSB7XG4gIHJldHVybiB0eXBlb2YgYXJnID09PSAnZnVuY3Rpb24nO1xufVxuXG5mdW5jdGlvbiBpc051bWJlcihhcmcpIHtcbiAgcmV0dXJuIHR5cGVvZiBhcmcgPT09ICdudW1iZXInO1xufVxuXG5mdW5jdGlvbiBpc09iamVjdChhcmcpIHtcbiAgcmV0dXJuIHR5cGVvZiBhcmcgPT09ICdvYmplY3QnICYmIGFyZyAhPT0gbnVsbDtcbn1cblxuZnVuY3Rpb24gaXNVbmRlZmluZWQoYXJnKSB7XG4gIHJldHVybiBhcmcgPT09IHZvaWQgMDtcbn1cbiIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgnLi9saWIvaXRzLmpzJyk7IiwiLy8gSGVscGVyc1xyXG52YXIgc2xpY2UgPSBBcnJheS5wcm90b3R5cGUuc2xpY2U7XHJcbnZhciB0b1N0cmluZyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmc7XHJcblxyXG52YXIgdGVtcGxhdGVSZWdFeCA9IC8lcy87IC8vIFRoZSB0ZW1wbGF0ZSBwbGFjZWhvbGRlciwgdXNlZCB0byBzcGxpdCBtZXNzYWdlIHRlbXBsYXRlc1xyXG5cclxuLyoqIEEgYmFzaWMgdGVtcGxhdGluZyBmdW5jdGlvbi4gXHJcblx0XHJcblx0VGFrZXMgYSBzdHJpbmcgd2l0aCAwIG9yIG1vcmUgJyVzJyBwbGFjZWhvbGRlcnMgYW5kIGFuIGFycmF5IHRvIHBvcHVsYXRlIGl0IHdpdGguXHJcblxyXG5cdEBwYXJhbSB7U3RyaW5nfSBtZXNzYWdlVGVtcGxhdGUgQSBzdHJpbmcgd2hpY2ggbWF5IG9yIG1heSBub3QgaGF2ZSAwIG9yIG1vcmUgJyVzJyB0byBkZW5vdGUgYXJndW1lbnQgcGxhY2VtZW50XHJcblx0QHBhcmFtIHtBcnJheX0gW21lc3NhZ2VBcmd1bWVudHNdIEl0ZW1zIHRvIHBvcHVsYXRlIHRoZSB0ZW1wbGF0ZSB3aXRoXHJcblxyXG5cdEBleGFtcGxlXHJcblx0XHR0ZW1wbGF0ZWRNZXNzYWdlKFwiSGVsbG9cIik7IC8vIHJldHVybnMgXCJIZWxsb1wiXHJcblx0XHR0ZW1wbGF0ZWRNZXNzYWdlKFwiSGVsbG8sICVzXCIsIFtcIndvcmxkXCJdKTsgLy8gcmV0dXJucyBcIkhlbGxvLCB3b3JsZFwiXHJcblx0XHR0ZW1wbGF0ZWRNZXNzYWdlKFwiSGVsbG8sICVzLiBJdCdzICVzIGRlZ3JlZXMgb3V0c2lkZS5cIiwgW1wid29ybGRcIiwgNzJdKTsgLy8gcmV0dXJucyBcIkhlbGxvLCB3b3JsZC4gSXQncyA3MiBkZWdyZWVzIG91dHNpZGVcIlxyXG5cclxuXHRAcmV0dXJucyB7U3RyaW5nfSBUaGUgcmVzb2x2ZWQgbWVzc2FnZVxyXG4qL1xyXG52YXIgdGVtcGxhdGVkTWVzc2FnZSA9IGZ1bmN0aW9uKG1lc3NhZ2VUZW1wbGF0ZSwgbWVzc2FnZUFyZ3VtZW50cyl7XHJcblx0dmFyIHJlc3VsdCA9IFtdLFxyXG5cdFx0bWVzc2FnZUFycmF5ID0gbWVzc2FnZVRlbXBsYXRlLnNwbGl0KHRlbXBsYXRlUmVnRXgpLFxyXG5cdFx0aW5kZXggPSAwLFxyXG5cdFx0bGVuZ3RoID0gbWVzc2FnZUFycmF5Lmxlbmd0aDtcclxuXHJcblx0Zm9yKDsgaW5kZXggPCBsZW5ndGg7IGluZGV4Kyspe1xyXG5cdFx0cmVzdWx0LnB1c2gobWVzc2FnZUFycmF5W2luZGV4XSk7XHJcblx0XHRyZXN1bHQucHVzaChtZXNzYWdlQXJndW1lbnRzW2luZGV4XSk7XHJcblx0fVxyXG5cclxuXHRyZXR1cm4gcmVzdWx0LmpvaW4oJycpO1xyXG59O1xyXG5cclxuXHJcbi8qKiBHZW5lcmljIGNoZWNrIGZ1bmN0aW9uIHdoaWNoIHRocm93cyBhbiBlcnJvciBpZiBhIGdpdmVuIGV4cHJlc3Npb24gaXMgZmFsc2VcclxuKlxyXG4qXHRUaGUgcGFyYW1zIGxpc3QgaXMgYSBiaXQgY29uZnVzaW5nLCBjaGVjayB0aGUgZXhhbXBsZXMgdG8gc2VlIHRoZSBhdmFpbGFibGUgd2F5cyBvZiBjYWxsaW5nIHRoaXMgZnVuY3Rpb25cclxuKlxyXG4qXHRAcGFyYW0ge0Jvb2xlYW59IGV4cHJlc3Npb24gVGhlIGRldGVybWluYW50IG9mIHdoZXRoZXIgYW4gZXhjZXB0aW9uIGlzIHRocm93blxyXG4qXHRAcGFyYW0ge1N0cmluZ3xPYmplY3R9IFttZXNzYWdlT3JFcnJvclR5cGVdIEEgbWVzc2FnZSBvciBhbiBFcnJvclR5cGUgb2JqZWN0IHRvIHRocm93IGlmIGV4cHJlc3Npb24gaXMgZmFsc2VcclxuKiAgIEBwYXJhbSB7U3RyaW5nfE9iamVjdH0gW21lc3NhZ2VPck1lc3NhZ2VBcmdzXSBBIG1lc3NhZ2UsIG1lc3NhZ2UgdGVtcGxhdGUsIG9yIGEgbWVzc2FnZSBhcmd1bWVudFxyXG4qXHRAcGFyYW0gey4uLk9iamVjdH0gW21lc3NhZ2VBcmdzXSBBcmd1bWVudHMgZm9yIGEgcHJvdmlkZWQgbWVzc2FnZSB0ZW1wbGF0ZVxyXG4qXHJcbipcdEByZXR1cm5zIHtCb29sZWFufSBSZXR1cm5zIHRoZSBleHByZXNzaW9uIHBhc3NlZCAgXHJcbipcdEB0aHJvd3Mge0Vycm9yfVxyXG4qXHJcbipcdEBleGFtcGxlXHJcbipcdFx0aXRzKDAgPCAxMCk7IC8vIHJldHVybnMgdHJ1ZVxyXG4qXHRcdGl0cygwID4gMTApOyAvLyB0aHJvd3MgRXJyb3Igd2l0aCBubyBtZXNzYWdlXHJcbipcdFx0aXRzKDAgPiAxMCwgXCJTb21ldGhpbmcgd2VudCB3cm9uZyFcIik7IC8vIHRocm93cyBFcnJvciB3aXRoIG1lc3NhZ2U6IFwiU29tZXRoaW5nIHdlbnQgd3JvbmchXCJcclxuKlx0XHRpdHMoMCA+IDEwLCBcIiVzIHdlbnQgJXMhXCIsIFwic29tZXRoaW5nXCIsIFwid3JvbmdcIik7IC8vIHRocm93cyBFcnJvciB3aXRoIG1lc3NhZ2U6IFwiU29tZXRoaW5nIHdlbnQgd3JvbmchXCJcclxuKlx0XHRpdHMoMCA+IDEwLCBSYW5nZUVycm9yLCBcIiVzIHdlbnQgJXMhXCIsIFwic29tZXRoaW5nXCIsIFwid3JvbmdcIik7IC8vIHRocm93cyBSYW5nZUVycm9yIHdpdGggbWVzc2FnZTogXCJTb21ldGhpbmcgd2VudCB3cm9uZyFcIlxyXG4qXHRcdGl0cygwID4gMTAsIFJhbmdlRXJyb3IpOyAvLyB0aHJvd3MgUmFuZ2VFcnJvciB3aXRoIG5vIG1lc3NhZ2VcclxuKi9cclxudmFyIGl0cyA9IG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oZXhwcmVzc2lvbiwgbWVzc2FnZU9yRXJyb3JUeXBlKXtcclxuXHRpZihleHByZXNzaW9uID09PSBmYWxzZSl7XHJcblx0XHRpZihtZXNzYWdlT3JFcnJvclR5cGUgJiYgdHlwZW9mIG1lc3NhZ2VPckVycm9yVHlwZSAhPT0gXCJzdHJpbmdcIil7IC8vIENoZWNrIGlmIGN1c3RvbSBlcnJvciBvYmplY3QgcGFzc2VkXHJcblx0XHRcdHRocm93IG1lc3NhZ2VPckVycm9yVHlwZShhcmd1bWVudHMubGVuZ3RoID4gMyA/IHRlbXBsYXRlZE1lc3NhZ2UoYXJndW1lbnRzWzJdLCBzbGljZS5jYWxsKGFyZ3VtZW50cywzKSkgOiBhcmd1bWVudHNbMl0pO1x0XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoYXJndW1lbnRzLmxlbmd0aCA+IDIgPyB0ZW1wbGF0ZWRNZXNzYWdlKG1lc3NhZ2VPckVycm9yVHlwZSwgc2xpY2UuY2FsbChhcmd1bWVudHMsMikpIDogbWVzc2FnZU9yRXJyb3JUeXBlKTtcdFxyXG5cdFx0fVxyXG5cdH1cclxuXHRyZXR1cm4gZXhwcmVzc2lvbjtcclxufTtcclxuXHJcbi8qKiBUaHJvd3MgYSBUeXBlRXJyb3IgaWYgYSBnaXZlbiBleHByZXNzaW9uIGlzIGZhbHNlXHJcbipcclxuKlx0QHBhcmFtIHtCb29sZWFufSBleHByZXNzaW9uIFRoZSBkZXRlcm1pbmFudCBvZiB3aGV0aGVyIGFuIGV4Y2VwdGlvbiBpcyB0aHJvd25cclxuKlx0QHBhcmFtIHtTdHJpbmd9IFttZXNzYWdlXSBBIG1lc3NhZ2Ugb3IgbWVzc2FnZSB0ZW1wbGF0ZSBmb3IgdGhlIGVycm9yIChpZiBpdCBnZXRzIHRocm93bilcclxuKlx0QHBhcmFtIHsuLi5PYmplY3R9IFttZXNzYWdlQXJnc10gQXJndW1lbnRzIGZvciBhIHByb3ZpZGVkIG1lc3NhZ2UgdGVtcGxhdGVcclxuKlxyXG4qXHRAcmV0dXJucyB7Qm9vbGVhbn0gUmV0dXJucyB0aGUgZXhwcmVzc2lvbiBwYXNzZWQgIFxyXG4qXHRAdGhyb3dzIHtUeXBlRXJyb3J9XHJcbipcclxuKlx0QGV4YW1wbGVcclxuKlx0XHRpdHMudHlwZSh0eXBlb2YgXCJUZWFtXCIgPT09IFwic3RyaW5nXCIpOyAvLyByZXR1cm5zIHRydWVcclxuKlx0XHRpdHMudHlwZSh0eXBlb2YgXCJUZWFtXCIgPT09IFwibnVtYmVyXCIpOyAvLyB0aHJvd3MgVHlwZUVycm9yIHdpdGggbm8gbWVzc2FnZVxyXG4qXHRcdGl0cy50eXBlKHZvaWQgMCwgXCJTb21ldGhpbmcgd2VudCB3cm9uZyFcIik7IC8vIHRocm93cyBUeXBlRXJyb3Igd2l0aCBtZXNzYWdlOiBcIlNvbWV0aGluZyB3ZW50IHdyb25nIVwiXHJcbipcdFx0aXRzLnR5cGUodm9pZCAwLCBcIiVzIHdlbnQgJXMhXCIsIFwic29tZXRoaW5nXCIsIFwid3JvbmdcIik7IC8vIHRocm93cyBUeXBlRXJyb3Igd2l0aCBtZXNzYWdlOiBcIlNvbWV0aGluZyB3ZW50IHdyb25nIVwiXHJcbiovXHJcbml0cy50eXBlID0gZnVuY3Rpb24oZXhwcmVzc2lvbiwgbWVzc2FnZSl7XHJcblx0aWYoZXhwcmVzc2lvbiA9PT0gZmFsc2Upe1xyXG5cdFx0dGhyb3cgbmV3IFR5cGVFcnJvcihhcmd1bWVudHMubGVuZ3RoID4gMiA/IHRlbXBsYXRlZE1lc3NhZ2UobWVzc2FnZSwgc2xpY2UuY2FsbChhcmd1bWVudHMsMikpIDogbWVzc2FnZSk7XHJcblx0fVxyXG5cdHJldHVybiBleHByZXNzaW9uO1xyXG59O1xyXG5cclxuLy8gSGVscGVyc1xyXG5pdHMudW5kZWZpbmVkID0gZnVuY3Rpb24oZXhwcmVzc2lvbil7XHJcblx0cmV0dXJuIGl0cy50eXBlLmFwcGx5KG51bGwsIFtleHByZXNzaW9uID09PSB2b2lkIDBdLmNvbmNhdChzbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpKTtcclxufTtcclxuXHJcbml0cy5udWxsID0gZnVuY3Rpb24oZXhwcmVzc2lvbil7XHJcblx0cmV0dXJuIGl0cy50eXBlLmFwcGx5KG51bGwsIFtleHByZXNzaW9uID09PSBudWxsXS5jb25jYXQoc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKSk7XHJcbn07XHJcblxyXG5pdHMuYm9vbGVhbiA9IGZ1bmN0aW9uKGV4cHJlc3Npb24pe1xyXG5cdHJldHVybiBpdHMudHlwZS5hcHBseShudWxsLCBbZXhwcmVzc2lvbiA9PT0gdHJ1ZSB8fCBleHByZXNzaW9uID09PSBmYWxzZSB8fCB0b1N0cmluZy5jYWxsKGV4cHJlc3Npb24pID09PSBcIltvYmplY3QgQm9vbGVhbl1cIl0uY29uY2F0KHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSkpO1xyXG59O1xyXG5cclxuaXRzLmFycmF5ID0gZnVuY3Rpb24oZXhwcmVzc2lvbil7XHJcblx0cmV0dXJuIGl0cy50eXBlLmFwcGx5KG51bGwsIFt0b1N0cmluZy5jYWxsKGV4cHJlc3Npb24pID09PSBcIltvYmplY3QgQXJyYXldXCJdLmNvbmNhdChzbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpKTtcclxufTtcclxuXHJcbml0cy5vYmplY3QgPSBmdW5jdGlvbihleHByZXNzaW9uKXtcclxuXHRyZXR1cm4gaXRzLnR5cGUuYXBwbHkobnVsbCwgW2V4cHJlc3Npb24gPT09IE9iamVjdChleHByZXNzaW9uKV0uY29uY2F0KHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSkpO1xyXG59O1xyXG5cclxuLyoqIFRoaXMgYmxvY2sgY3JlYXRlcyBcclxuKlx0aXRzLmZ1bmN0aW9uXHJcbipcdGl0cy5zdHJpbmdcclxuKlx0aXRzLm51bWJlclxyXG4qXHRpdHMuZGF0ZVxyXG4qXHRpdHMucmVnZXhwXHJcbiovXHJcbihmdW5jdGlvbigpe1xyXG5cdHZhciB0eXBlcyA9IFtcclxuXHRcdFx0WydhcmdzJywnQXJndW1lbnRzJ10sXHJcblx0XHRcdFsnZnVuYycsICdGdW5jdGlvbiddLCBcclxuXHRcdFx0WydzdHJpbmcnLCAnU3RyaW5nJ10sIFxyXG5cdFx0XHRbJ251bWJlcicsICdOdW1iZXInXSwgXHJcblx0XHRcdFsnZGF0ZScsICdEYXRlJ10sIFxyXG5cdFx0XHRbJ3JlZ2V4cCcsICdSZWdFeHAnXVxyXG5cdFx0XSxcclxuXHRcdGluZGV4ID0gMCxcclxuXHRcdGxlbmd0aCA9IHR5cGVzLmxlbmd0aDtcclxuXHJcblx0Zm9yKDsgaW5kZXggPCBsZW5ndGg7IGluZGV4Kyspe1xyXG5cdFx0KGZ1bmN0aW9uKCl7XHJcblx0XHRcdHZhciB0aGVUeXBlID0gdHlwZXNbaW5kZXhdO1xyXG5cdFx0XHRpdHNbdGhlVHlwZVswXV0gPSBmdW5jdGlvbihleHByZXNzaW9uKXtcclxuXHRcdFx0XHRyZXR1cm4gaXRzLnR5cGUuYXBwbHkobnVsbCwgW3RvU3RyaW5nLmNhbGwoZXhwcmVzc2lvbikgPT09ICdbb2JqZWN0ICcgKyB0aGVUeXBlWzFdICsgJ10nXS5jb25jYXQoc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKSk7XHJcblx0XHRcdH07XHJcblx0XHR9KCkpO1xyXG5cdH1cclxufSgpKTtcclxuXHJcbi8vIG9wdGltaXphdGlvbiBmcm9tIHVuZGVyc2NvcmUuanMgYnkgZG9jdW1lbnRjbG91ZCAtLSB1bmRlcnNjb3JlanMub3JnXHJcbmlmICh0eXBlb2YgKC8uLykgIT09ICdmdW5jdGlvbicpIHtcclxuXHRpdHMuZnVuYyA9IGZ1bmN0aW9uKGV4cHJlc3Npb24pIHtcclxuXHRcdHJldHVybiBpdHMudHlwZS5hcHBseShudWxsLCBbdHlwZW9mIGV4cHJlc3Npb24gPT09IFwiZnVuY3Rpb25cIl0uY29uY2F0KHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSkpO1xyXG5cdH07XHJcbn1cclxuXHJcbi8qKiBUaHJvd3MgYSBSZWZlcmVuY2VFcnJvciBpZiBhIGdpdmVuIGV4cHJlc3Npb24gaXMgZmFsc2VcclxuKlxyXG4qXHRAcGFyYW0ge0Jvb2xlYW59IGV4cHJlc3Npb24gVGhlIGRldGVybWluYW50IG9mIHdoZXRoZXIgYW4gZXhjZXB0aW9uIGlzIHRocm93blxyXG4qXHRAcGFyYW0ge1N0cmluZ30gW21lc3NhZ2VdIEEgbWVzc2FnZSBvciBtZXNzYWdlIHRlbXBsYXRlIGZvciB0aGUgZXJyb3IgKGlmIGl0IGdldHMgdGhyb3duKVxyXG4qXHRAcGFyYW0gey4uLk9iamVjdH0gW21lc3NhZ2VBcmdzXSBBcmd1bWVudHMgZm9yIGEgcHJvdmlkZWQgbWVzc2FnZSB0ZW1wbGF0ZVxyXG4qXHJcbipcdEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIGV4cHJlc3Npb24gcGFzc2VkICBcclxuKlx0QHRocm93cyB7UmVmZXJlbmNlRXJyb3J9XHJcbipcclxuKlx0QGV4YW1wbGVcclxuKlx0XHRpdHMuZGVmaW5lZChcIlNvbWV0aGluZ1wiKTsgLy8gcmV0dXJucyB0cnVlXHJcbipcdFx0aXRzLmRlZmluZWQodm9pZCAwKTsgLy8gdGhyb3dzIFJlZmVyZW5jZUVycm9yIHdpdGggbm8gbWVzc2FnZVxyXG4qXHRcdGl0cy5kZWZpbmVkKHZvaWQgMCwgXCJTb21ldGhpbmcgd2VudCB3cm9uZyFcIik7IC8vIHRocm93cyBSZWZlcmVuY2VFcnJvciB3aXRoIG1lc3NhZ2U6IFwiU29tZXRoaW5nIHdlbnQgd3JvbmchXCJcclxuKlx0XHRpdHMuZGVmaW5lZCh2b2lkIDAsIFwiJXMgd2VudCAlcyFcIiwgXCJzb21ldGhpbmdcIiwgXCJ3cm9uZ1wiKTsgLy8gdGhyb3dzIFJlZmVyZW5jZUVycm9yIHdpdGggbWVzc2FnZTogXCJTb21ldGhpbmcgd2VudCB3cm9uZyFcIlxyXG4qL1xyXG5pdHMuZGVmaW5lZCA9IGZ1bmN0aW9uKGV4cHJlc3Npb24sIG1lc3NhZ2Upe1xyXG5cdGlmKGV4cHJlc3Npb24gPT09IHZvaWQgMCl7XHJcblx0XHR0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoYXJndW1lbnRzLmxlbmd0aCA+IDIgPyB0ZW1wbGF0ZWRNZXNzYWdlKG1lc3NhZ2UsIHNsaWNlLmNhbGwoYXJndW1lbnRzLDIpKSA6IG1lc3NhZ2UpO1xyXG5cdH1cclxuXHJcblx0cmV0dXJuIGV4cHJlc3Npb247XHJcbn07XHJcblxyXG4vKiogVGhyb3dzIGEgUmFuZ2VFcnJvciBpZiBhIGdpdmVuIGV4cHJlc3Npb24gaXMgZmFsc2VcclxuKlxyXG4qXHRAcGFyYW0ge0Jvb2xlYW59IGV4cHJlc3Npb24gVGhlIGRldGVybWluYW50IG9mIHdoZXRoZXIgYW4gZXhjZXB0aW9uIGlzIHRocm93blxyXG4qXHRAcGFyYW0ge1N0cmluZ30gW21lc3NhZ2VdIEEgbWVzc2FnZSBvciBtZXNzYWdlIHRlbXBsYXRlIGZvciB0aGUgZXJyb3IgKGlmIGl0IGdldHMgdGhyb3duKVxyXG4qXHRAcGFyYW0gey4uLk9iamVjdH0gW21lc3NhZ2VBcmdzXSBBcmd1bWVudHMgZm9yIGEgcHJvdmlkZWQgbWVzc2FnZSB0ZW1wbGF0ZVxyXG4qXHJcbipcdEByZXR1cm5zIHtCb29sZWFufSBSZXR1cm5zIHRoZSBleHByZXNzaW9uIHBhc3NlZCAgXHJcbipcdEB0aHJvd3Mge1JhbmdlRXJyb3J9XHJcbipcclxuKlx0QGV4YW1wbGVcclxuKlx0XHRpdHMucmFuZ2UoMSA+IDApOyAvLyByZXR1cm5zIHRydWVcclxuKlx0XHRpdHMucmFuZ2UoMSA8IDIpOyAvLyB0aHJvd3MgUmFuZ2VFcnJvciB3aXRoIG5vIG1lc3NhZ2VcclxuKlx0XHRpdHMucmFuZ2UoMSA8IDIgJiYgMSA+IDIsIFwiU29tZXRoaW5nIHdlbnQgd3JvbmchXCIpOyAvLyB0aHJvd3MgUmFuZ2VFcnJvciB3aXRoIG1lc3NhZ2U6IFwiU29tZXRoaW5nIHdlbnQgd3JvbmchXCJcclxuKlx0XHRpdHMucmFuZ2UoMSA8IDIgJiYgMSA+IDIsIFwiJXMgd2VudCAlcyFcIiwgXCJzb21ldGhpbmdcIiwgXCJ3cm9uZ1wiKTsgLy8gdGhyb3dzIFJhbmdlRXJyb3Igd2l0aCBtZXNzYWdlOiBcIlNvbWV0aGluZyB3ZW50IHdyb25nIVwiXHJcbiovXHJcbml0cy5yYW5nZSA9IGZ1bmN0aW9uKGV4cHJlc3Npb24sIG1lc3NhZ2Upe1xyXG5cdGlmKGV4cHJlc3Npb24gPT09IGZhbHNlKXtcclxuXHRcdHRocm93IG5ldyBSYW5nZUVycm9yKGFyZ3VtZW50cy5sZW5ndGggPiAyID8gdGVtcGxhdGVkTWVzc2FnZShtZXNzYWdlLCBzbGljZS5jYWxsKGFyZ3VtZW50cywyKSkgOiBtZXNzYWdlKTtcclxuXHR9XHJcblxyXG5cdHJldHVybiBleHByZXNzaW9uO1xyXG59OyJdfQ==","var JSONProtocol = require('./JSONProtocol.js'),\n\tits = require('its'),\n\tEmitter = require('events').EventEmitter;\n\nfunction notImplemented(){\n\tthrow new Error('This method is not implemented');\n}\n\nfunction Connection(address, peers, options){\n\tits.string(address);\n\tits.defined(peers);\n\n\tthis.address = address;\n\tthis.peers = peers;\n\n\tif(options){\n\t\tif(options.emitter) this.emitter = options.emitter;\n\t\tif(options.firewall) this.acceptRTCConnection = options.firewall;\n\t}\n\n\tif(!this.emitter) this.emitter = new Connection.Emitter();\n}\n\n// Circular dependency solved in WebRTCConnection.js\nConnection.createWebRTCConnection = null;\n\nConnection.Emitter = Emitter;\n\nConnection.prototype = Object.create(JSONProtocol.prototype);\n\nConnection.prototype.on = function(){\n\tthis.emitter.on.apply(this.emitter, arguments);\n\treturn this;\n};\n\nConnection.prototype.removeListener = function(){\n\tthis.emitter.removeListener.apply(this.emitter, arguments);\n\treturn this;\n};\n\nConnection.prototype.send = JSONProtocol.prototype.writeMessage;\n\nConnection.prototype.getPeer = function(address){\n\treturn this.peers.get(address);\n};\n\nConnection.prototype.addPeer = function(peer){\n\treturn this.peers.add(peer);\n};\n\nConnection.prototype.getPeers = function() {\n\treturn this.peers.get();\n};\n\nfunction isString(candidate){\n\treturn Object.prototype.toString.call(candidate) === '[object String]';\n}\n\nConnection.prototype.connect = function(config){\n\tif(isString(config)){\n\t\tconfig = {address: config};\n\t}\n\n\tvar self = this,\n\t\tfirewall = config.firewall || this.firewall,\n\t\tpeer = Connection.createWebRTCConnection(config, this.peers, this, {firewall: firewall});\n\n\tpeer.writeOffer(config);\n\n\tthis.peers.add(peer);\n\n\tpeer.on('close', function(){\n\t\tself.peers.remove(peer);\n\t\tself.emitter.emit('disconnection', peer);\n\t});\n\n\tthis.emitter.emit('connection', peer);\n\n\treturn peer;\n};\n\nConnection.prototype.readMessage = function(message){\n\tthis.emitter.emit('message', message);\n};\n\nConnection.prototype.readArrayBuffer = function(message){\n\tthis.emitter.emit('arraybuffer', message);\n};\n\nConnection.prototype.acceptRTCConnection = function(/*description, data*/){\n\treturn true;\n};\n\nConnection.prototype.readRelay = function(peerAddress, message){\n\tvar peer = this.getPeer(peerAddress);\n\n\tif(!peer){\n\t\tthis.emitter.emit('error', new Error('Unknown peer at address: ' + peerAddress));\n\t\treturn;\n\t}\n\n\tpeer.writeRelayedMessage(this.address, message);\n};\n\nConnection.prototype.readRelayedIceCandidate = function(peerAddress, candidate){\n\tvar peer = this.getPeer(peerAddress);\n\n\tif(!peer){\n\t\tthis.emitter.emit('error', new Error('Unknown peer at address: ' + peerAddress));\n\t\treturn;\n\t}\n\n\tpeer.readIceCandidate(candidate);\n};\n\nConnection.prototype.readRelayedOffer = function(peerAddress, description, data){\n\tif(!this.acceptRTCConnection(description, data)) return false;\n\n\tvar self = this,\n\t\tpeer = Connection.createWebRTCConnection({address:peerAddress}, this.peers, this, {firewall: this.firewall});\n\n\tthis.addPeer(peer);\n\n\tpeer.on('close', function(){\n\t\tself.peers.remove(peer);\n\t\tself.emitter.emit('disconnection', peer);\n\t});\n\n\tpeer.readOffer(description);\n\tpeer.writeAnswer();\n\n\tthis.emitter.emit('connection', peer);\n};\n\nConnection.prototype.readRelayedAnswer = function(peerAddress, description){\n\tvar peer = this.getPeer(peerAddress);\n\n\tif(!peer){\n\t\tthis.emitter.emit('error', new Error('Unknown peer at address: ' + peerAddress));\n\t\treturn;\n\t}\n\n\tpeer.readAnswer(description);\n};\n\nConnection.prototype.close = notImplemented; // implemented higher up\nConnection.prototype.getReadyState = notImplemented; // implemented higher up\n\nConnection.prototype.isOpen = function(){\n\treturn this.getReadyState() === 'open';\n};\n\nmodule.exports = Connection;\n","var its = require('its');\n\nfunction noop(){}\n\nfunction ConnectionManager(){\n\tthis.connectionMap = {};\n\tthis.connectionList = [];\n}\n\nConnectionManager.prototype.get = function(address){\n\tif(address === undefined) return this.connectionList.slice();\n\n\treturn this.connectionMap[address];\n};\n\nConnectionManager.prototype.add = function(connection) {\n\tits.defined(connection);\n\n\tvar address = connection.address;\n\tits.string(address);\n\n\tif(address in this.connectionMap) return false;\n\t\n\tthis.connectionMap[address] = connection;\n\tthis.connectionList.push(connection);\n\n\tthis.onAdd(connection);\n\treturn true;\n};\nConnectionManager.prototype.onAdd = noop;\n\nConnectionManager.prototype.remove = function(connection){\n\tits.defined(connection);\n\n\tvar address = connection.address;\n\tits.string(address);\n\n\tvar mappedConnection = this.connectionMap[address];\n\tif(!mappedConnection || mappedConnection !== connection) return false;\n\n\tdelete this.connectionMap[address];\n\t\n\tvar index = this.connectionList.indexOf(connection);\n\tthis.connectionList.splice(index, 1);\n\n\tthis.onRemove(connection);\n\treturn true;\n};\nConnectionManager.prototype.onRemove = noop;\n\nmodule.exports = ConnectionManager;","function notImplemented(){\n\tthrow new Error('This method is not implemented');\n}\n\nfunction JSONProtocol(){}\n\nJSONProtocol.prototype.PROTOCOL_NAME = 'p';\n\nJSONProtocol.prototype.MESSAGE_TYPE = {\n\tDIRECT: 0, // [0, message]\n\n\tRTC_OFFER: 3, // [3, description, data]\n\tRTC_ANSWER: 4, // [4, description]\n\tRTC_ICE_CANDIDATE: 5, // [5, candidate]\n\n\tRELAY: 6, // [6, address, message]\n\tRELAYED: 7 // [7, address, message]\n};\n\nJSONProtocol.prototype.readRaw = function(message){\n\tif(message instanceof ArrayBuffer){\n\t\tthis.readArrayBuffer(message);\n\t} else {\n\t\tthis.readProtocolMessage(JSON.parse(message));\n\t}\t\n};\n\nJSONProtocol.prototype.readProtocolMessage = function(message){\n\tvar MESSAGE_TYPE = this.MESSAGE_TYPE,\n\t\tmessageType = message[0];\n\t\n\tswitch(messageType){\n\t\t// This is a message from the remote node to this one.\n\t\tcase MESSAGE_TYPE.DIRECT:\n\t\t\tthis.readMessage(message[1]);\n\t\t\tbreak;\n\n\t\t// The message was relayed by the peer on behalf of\n\t\t// a third party peer, identified by \"thirdPartyPeerId\".\n\t\t// This means that the peer is acting as a signalling\n\t\t// channel on behalf of the third party peer.\n\t\tcase MESSAGE_TYPE.RELAYED:\n\t\t\tthis.readRelayedMessage(message[1], message[2]);\n\t\t\tbreak;\n\n\t\t// The message is intended for another peer, identified\n\t\t// by \"peerId\", which is also connected to this node.\n\t\t// This means that the peer is using this connection\n\t\t// as a signalling channel in order to establish a connection\n\t\t// to the other peer identified \"peerId\".\n\t\tcase MESSAGE_TYPE.RELAY:\n\t\t\tthis.readRelay(message[1], message[2]);\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tthrow new Error('Unknown message type: ' + messageType);\n\t}\n};\n\nJSONProtocol.prototype.readRelayedMessage = function(origin, message){\n\tvar MESSAGE_TYPE = this.MESSAGE_TYPE,\n\t\tmessageType = message[0];\n\n\tswitch(messageType){\n\t\t// An initial connection request from a third party peer\n\t\tcase MESSAGE_TYPE.RTC_OFFER:\n\t\t\tthis.readRelayedOffer(origin, message[1], message[2]);\n\t\t\tbreak;\n\t\t\n\t\t// An answer to an RTC offer sent from this node\n\t\tcase MESSAGE_TYPE.RTC_ANSWER:\n\t\t\tthis.readRelayedAnswer(origin, message[1]);\n\t\t\tbreak;\n\t\t\n\t\t// An ICE candidate from the source node\n\t\tcase MESSAGE_TYPE.RTC_ICE_CANDIDATE:\n\t\t\tthis.readRelayedIceCandidate(origin, message[1]);\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tthrow new Error('Unknown message type: ' + messageType);\n\t}\t\t\n};\n\nJSONProtocol.prototype.readMessage = notImplemented;\nJSONProtocol.prototype.readArrayBuffer = notImplemented;\nJSONProtocol.prototype.readRelay = notImplemented;\n\nJSONProtocol.prototype.readRelayedOffer = notImplemented;\nJSONProtocol.prototype.readRelayedAnswer = notImplemented;\nJSONProtocol.prototype.readRelayedIceCandidate = notImplemented;\n\nJSONProtocol.prototype.writeRaw = notImplemented;\n\nJSONProtocol.prototype.writeProtocolMessage = function(message){\n\tvar serializedMessage = JSON.stringify(message);\n\tthis.writeRaw(serializedMessage);\n};\n\nJSONProtocol.prototype.writeMessage = function(message){\n\tif(message instanceof ArrayBuffer){\n\t\tthis.writeRaw(message);\n\t} else {\n\t\tthis.writeStringMessage(message);\n\t}\n};\n\nJSONProtocol.prototype.writeStringMessage = function(message){\n\tthis.writeProtocolMessage([\n\t\tthis.MESSAGE_TYPE.DIRECT,\n\t\tmessage\n\t]);\n};\n\nJSONProtocol.prototype.writeRelayedMessage = function(origin, message){\n\tthis.writeProtocolMessage([\n\t\tthis.MESSAGE_TYPE.RELAYED,\n\t\torigin,\n\t\tmessage\n\t]);\n};\n\nJSONProtocol.prototype.writeRelayMessage = function(destination, message){\n\tthis.writeProtocolMessage([\n\t\tthis.MESSAGE_TYPE.RELAY,\n\t\tdestination,\n\t\tmessage\n\t]);\n};\n\nJSONProtocol.prototype.writeRelayAnswer = function(destination, description){\n\tthis.writeRelayMessage(destination, [\n\t\tthis.MESSAGE_TYPE.RTC_ANSWER,\n\t\tdescription\n\t]);\n};\n\nJSONProtocol.prototype.writeRelayIceCandidate = function(destination, candidate){\n\tthis.writeRelayMessage(destination, [\n\t\tthis.MESSAGE_TYPE.RTC_ICE_CANDIDATE,\n\t\tcandidate\n\t]);\n};\n\nJSONProtocol.prototype.writeRelayOffer = function(destination, description, data){\n\tthis.writeRelayMessage(destination, [\n\t\tthis.MESSAGE_TYPE.RTC_OFFER,\n\t\tdescription,\n\t\tdata\n\t]);\n};\n\nmodule.exports = JSONProtocol;","var Emitter = require('events').EventEmitter,\n\tConnectionManager = require('./ConnectionManager.js'),\n\tWebSocketConnection = require('./WebSocketConnection.js'),\n\tits = require('its');\n\nrequire('./WebRtcConnection');\n\nfunction P(emitter, connectionManager, options){\n\tits.defined(emitter);\n\tits.defined(connectionManager);\n\n\tthis.emitter = emitter;\n\tthis.peers = connectionManager;\n\n\tthis.peers.onAdd = function(peer){\n\t\temitter.emit('connection', peer);\n\t};\n\n\tthis.peers.onRemove = function(peer){\n\t\temitter.emit('disconnection', peer);\n\t};\n\n\tif(options && options.firewall) this.firewall = options.firewall;\n}\n\nP.create = function(options){\n\tvar emitter = new Emitter(),\n\t\tconnectionManager = new ConnectionManager();\n\n\treturn new P(emitter, connectionManager, options);\n};\n\nP.prototype.getPeers = function(){\n\treturn this.peers.get();\n};\n\nP.prototype.connect = function(address){\n\tits.string(address);\n\n\tvar peers = this.peers,\n\t\tpeer = WebSocketConnection.create(address, this.peers, {firewall: this.firewall});\n\n\tpeers.add(peer);\n\n\tpeer.on('close', function(){\n\t\tpeers.remove(peer);\n\t});\n\n\treturn peer;\n};\n\nP.prototype.on = function(){\n\tthis.emitter.on.apply(this.emitter, arguments);\n\treturn this;\n};\n\nP.prototype.removeListener = function(){\n\tthis.emitter.removeListener.apply(this.emitter, arguments);\n\treturn this;\n};\n\nmodule.exports = P;\n","/*global\n\t\tRTCPeerConnection,\n\t\twebkitRTCPeerConnection,\n\t\tmozRTCPeerConnection,\n\t\tRTCSessionDescription,\n\t\tmozRTCSessionDescription,\n\t\tRTCIceCandidate,\n\t\tmozRTCIceCandidate\n*/\n\nvar Connection = require('./Connection.js'),\n\tits = require('its');\n\nvar nativeRTCPeerConnection = (typeof RTCPeerConnection !== 'undefined')? RTCPeerConnection :\n\t\t\t\t\t\t\t  (typeof webkitRTCPeerConnection !== 'undefined')? webkitRTCPeerConnection :\n\t\t\t\t\t\t\t  (typeof mozRTCPeerConnection !== 'undefined')? mozRTCPeerConnection :\n\t\t\t\t\t\t\t  undefined;\n\nvar nativeRTCSessionDescription = (typeof RTCSessionDescription !== 'undefined')? RTCSessionDescription :\n\t\t\t\t\t\t\t\t  (typeof mozRTCSessionDescription !== 'undefined')? mozRTCSessionDescription :\n\t\t\t\t\t\t\t\t  undefined;\nvar nativeRTCIceCandidate = (typeof RTCIceCandidate !== 'undefined')? RTCIceCandidate :\n\t\t\t\t\t\t\t(typeof mozRTCIceCandidate !== 'undefined')? mozRTCIceCandidate :\n\t\t\t\t\t\t\tundefined;\n\nvar log = function(){};\n\nif(typeof window !== 'undefined' && window.P_DEBUGGING_ENABLED){\n\tlog = function(label, event, obj){\n\t\twindow.console.debug(label, event, obj);\n\t};\n}\n\nfunction WebRTCConnection(address, peers, rtcConnection, signalingChannel, options){\n\tvar self = this;\n\n\tits.string(address);\n\tits.defined(peers);\n\tits.defined(rtcConnection);\n\tits.defined(signalingChannel);\n\n\tConnection.call(this, address, peers, options);\n\n\tthis.signalingChannel = signalingChannel;\n\tthis.rtcConnection = rtcConnection;\n\tthis.rtcDataChannel = rtcConnection.createDataChannel(this.PROTOCOL_NAME, {protocol: this.PROTOCOL_NAME});\n\n\n\t// Bug in FF seems to garbage collect the stale ref causing it to close\n\t// the prevents it from being lost in a GC event\n\tthis._initialRtcDataChannel = this.rtcDataChannel;\n\n\n\tthis.close = rtcConnection.close.bind(rtcConnection);\n\n\tthis.rtcConnection.addEventListener('icecandidate', function(event){\n\t\tif(!event.candidate) return;\n\t\tlog('ice candidate', event, self);\n\t\tself.signalingChannel.writeRelayIceCandidate(address, event.candidate);\n\t});\n\n\tthis.rtcConnection.addEventListener('datachannel', function(event){\n\t\tlog('datachannel', event, self);\n\n\t\tvar rtcDataChannel = self.rtcDataChannel = event.channel;\n\t\trtcDataChannel.addEventListener('open', function(event){\n\t\t\tlog('remote datachannel open', event, self);\n\t\t\tself.emitter.emit('open', event);\n\t\t});\n\n\t\trtcDataChannel.addEventListener('close', function(event){\n\t\t\tlog('remote datachannel close', event, self);\n\t\t\tself.emitter.emit('close', event);\n\t\t});\n\n\t\trtcDataChannel.addEventListener('error', function(event){\n\t\t\tlog('remote datachannel error', event, self);\n\t\t\tself.emitter.emit('error', event);\n\t\t});\n\t});\n\n\tthis.rtcDataChannel.addEventListener('message', function(message){\n\t\tlog('local datachannel message', message, self);\n\t\tself.readRaw(message.data);\n\t});\n\n\tthis.rtcDataChannel.addEventListener('error', function(event){\n\t\tlog('local datachannel error', event, self);\n\t\tself.emitter.emit('error', event);\n\t});\n\n\tthis.rtcDataChannel.addEventListener('close', function(event){\n\t\tlog('local datachannel close', event, self);\n\t\tself.emitter.emit('close', event);\n\t});\n}\n\nvar DEFAULT_RTC_CONFIGURATION = null;\nvar DEFAULT_RTC_OFFER_OPTIONS = {\n\tofferToReceiveAudio: false,\n\tofferToReceiveVideo: false,\n\ticeRestart: false\n};\n\n//DEFAULT_RTC_OFFER_OPTIONS\nWebRTCConnection.create = function(config, peers, signalingChannel, options){\n\tvar rtcConfiguration = config.rtcConfiguration || DEFAULT_RTC_CONFIGURATION,\n\t\trtcConnection = new nativeRTCPeerConnection(rtcConfiguration);\n\n\treturn new WebRTCConnection(config.address, peers, rtcConnection, signalingChannel, options);\n};\n\nWebRTCConnection.prototype = Object.create(Connection.prototype);\n\nWebRTCConnection.prototype.writeRaw = function(message){\n\tswitch(this.rtcDataChannel.readyState){\n\t\tcase 'connecting':\n\t\t\tthrow new Error('Can\\'t send a message while RTCDataChannel connecting');\n\t\tcase 'open':\n\t\t\tthis.rtcDataChannel.send(message);\n\t\t\tlog('sent message to remote', message, this);\n\t\t\tbreak;\n\t\tcase 'closing':\n\t\tcase 'closed':\n\t\t\tthrow new Error('Can\\'t send a message while RTCDataChannel is closing or closed');\n\t}\n};\n\nWebRTCConnection.prototype.readAnswer = function(description){\n\tvar rtcSessionDescription = new nativeRTCSessionDescription(description);\n\n\tthis.rtcConnection.setRemoteDescription(rtcSessionDescription);\n};\n\nWebRTCConnection.prototype.readOffer = function(description){\n\tvar rtcSessionDescription = new nativeRTCSessionDescription(description);\n\tthis.rtcConnection.setRemoteDescription(rtcSessionDescription);\n};\n\nWebRTCConnection.prototype.readIceCandidate = function(candidate){\n\tthis.rtcConnection.addIceCandidate(new nativeRTCIceCandidate(candidate));\n};\n\nWebRTCConnection.prototype.writeAnswer = function(){\n\tvar emitter = this.emitter,\n\t\taddress = this.address,\n\t\trtcConnection = this.rtcConnection,\n\t\tsignalingChannel = this.signalingChannel;\n\n\tfunction onError(err){ emitter.emit('error', err); }\n\n\trtcConnection.createAnswer(function(description){\n\t\trtcConnection.setLocalDescription(description, function(){\n\t\t\tsignalingChannel.writeRelayAnswer(address, description);\n\t\t}, onError);\n\t}, onError);\n};\n\nWebRTCConnection.prototype.writeOffer = function(config){\n\tvar emitter = this.emitter,\n\t\taddress = this.address,\n\t\trtcConnection = this.rtcConnection,\n\t\tsignalingChannel = this.signalingChannel;\n\n\tfunction onError(err){ emitter.emit('error', err); }\n\n\trtcConnection.createOffer(function(description){\n\t\trtcConnection.setLocalDescription(description, function(){\n\t\t\tsignalingChannel.writeRelayOffer(address, description, config.offerData);\n\t\t}, onError);\n\t}, onError, config.rtcOfferOptions || DEFAULT_RTC_OFFER_OPTIONS);\n};\n\nWebRTCConnection.prototype.getReadyState = function(){\n\treturn this.rtcDataChannel.readyState;\n};\n\n// Solves the circular dependency with Connection.js\nConnection.createWebRTCConnection = WebRTCConnection.create;\n\nmodule.exports = WebRTCConnection;\n","var Connection = require('./Connection.js');\n\nvar WebSocketState = {\n\tCONNECTING: 0,\n\tOPEN: 1,\n\tCLOSING: 2,\n\tCLOSED: 3\n};\n\nif(typeof WebSocket !== 'undefined'){\n\tWebSocketState = WebSocket;\n}\n\nfunction WebSocketConnection(address, peers, webSocket, options){\n\tvar self = this;\n\n\tConnection.call(this, address, peers, options);\n\n\tthis.webSocket = webSocket;\n\n\tthis.close = webSocket.close.bind(webSocket);\n\n\tthis.webSocket.addEventListener('message', function(message){\n\t\tself.readRaw(message.data);\n\t});\n\n\tthis.webSocket.addEventListener('open', function(event){\n\t\tself.emitter.emit('open', event);\n\t});\n\n\tthis.webSocket.addEventListener('error', function(event){\n\t\tself.emitter.emit('error', event);\n\t});\n\n\tthis.webSocket.addEventListener('close', function(event){\n\t\tself.emitter.emit('close', event);\n\t});\n}\n\nWebSocketConnection.create = function(address, peers, options){\n\tvar webSocket = new WebSocket(address, WebSocketConnection.prototype.PROTOCOL_NAME);\n\treturn new WebSocketConnection(address, peers, webSocket, options);\n};\n\nWebSocketConnection.prototype = Object.create(Connection.prototype);\nWebSocketConnection.prototype.writeRaw = function(message){\n\tswitch(this.webSocket.readyState){\n\t\tcase WebSocketState.CONNECTING:\n\t\t\tthrow new Error('Can\\'t send a message while WebSocket connecting');\n\n\t\tcase WebSocketState.OPEN:\n\t\t\tthis.webSocket.send(message);\n\t\t\tbreak;\n\n\t\tcase WebSocketState.CLOSING:\n\t\tcase WebSocketState.CLOSED:\n\t\t\tthrow new Error('Can\\'t send a message while WebSocket is closing or closed');\n\t}\n};\n\nWebSocketConnection.prototype.getReadyState = function(){\n\tswitch(this.webSocket.readyState){\n\t\tcase WebSocketState.CONNECTING:\n\t\t\treturn 'connecting';\n\t\tcase WebSocketState.OPEN:\n\t\t\treturn 'open';\n\t\tcase WebSocketState.CLOSING:\n\t\t\treturn 'closing';\n\t\tcase WebSocketState.CLOSED:\n\t\t\treturn 'closed';\n\t}\n};\n\nmodule.exports = WebSocketConnection;\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      }\n      throw TypeError('Uncaught, unspecified \"error\" event.');\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        len = arguments.length;\n        args = new Array(len - 1);\n        for (i = 1; i < len; i++)\n          args[i - 1] = arguments[i];\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    len = arguments.length;\n    args = new Array(len - 1);\n    for (i = 1; i < len; i++)\n      args[i - 1] = arguments[i];\n\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    var m;\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  var ret;\n  if (!emitter._events || !emitter._events[type])\n    ret = 0;\n  else if (isFunction(emitter._events[type]))\n    ret = 1;\n  else\n    ret = emitter._events[type].length;\n  return ret;\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n","module.exports = require('./lib/its.js');","// Helpers\r\nvar slice = Array.prototype.slice;\r\nvar toString = Object.prototype.toString;\r\n\r\nvar templateRegEx = /%s/; // The template placeholder, used to split message templates\r\n\r\n/** A basic templating function. \r\n\t\r\n\tTakes a string with 0 or more '%s' placeholders and an array to populate it with.\r\n\r\n\t@param {String} messageTemplate A string which may or may not have 0 or more '%s' to denote argument placement\r\n\t@param {Array} [messageArguments] Items to populate the template with\r\n\r\n\t@example\r\n\t\ttemplatedMessage(\"Hello\"); // returns \"Hello\"\r\n\t\ttemplatedMessage(\"Hello, %s\", [\"world\"]); // returns \"Hello, world\"\r\n\t\ttemplatedMessage(\"Hello, %s. It's %s degrees outside.\", [\"world\", 72]); // returns \"Hello, world. It's 72 degrees outside\"\r\n\r\n\t@returns {String} The resolved message\r\n*/\r\nvar templatedMessage = function(messageTemplate, messageArguments){\r\n\tvar result = [],\r\n\t\tmessageArray = messageTemplate.split(templateRegEx),\r\n\t\tindex = 0,\r\n\t\tlength = messageArray.length;\r\n\r\n\tfor(; index < length; index++){\r\n\t\tresult.push(messageArray[index]);\r\n\t\tresult.push(messageArguments[index]);\r\n\t}\r\n\r\n\treturn result.join('');\r\n};\r\n\r\n\r\n/** Generic check function which throws an error if a given expression is false\r\n*\r\n*\tThe params list is a bit confusing, check the examples to see the available ways of calling this function\r\n*\r\n*\t@param {Boolean} expression The determinant of whether an exception is thrown\r\n*\t@param {String|Object} [messageOrErrorType] A message or an ErrorType object to throw if expression is false\r\n*   @param {String|Object} [messageOrMessageArgs] A message, message template, or a message argument\r\n*\t@param {...Object} [messageArgs] Arguments for a provided message template\r\n*\r\n*\t@returns {Boolean} Returns the expression passed  \r\n*\t@throws {Error}\r\n*\r\n*\t@example\r\n*\t\tits(0 < 10); // returns true\r\n*\t\tits(0 > 10); // throws Error with no message\r\n*\t\tits(0 > 10, \"Something went wrong!\"); // throws Error with message: \"Something went wrong!\"\r\n*\t\tits(0 > 10, \"%s went %s!\", \"something\", \"wrong\"); // throws Error with message: \"Something went wrong!\"\r\n*\t\tits(0 > 10, RangeError, \"%s went %s!\", \"something\", \"wrong\"); // throws RangeError with message: \"Something went wrong!\"\r\n*\t\tits(0 > 10, RangeError); // throws RangeError with no message\r\n*/\r\nvar its = module.exports = function(expression, messageOrErrorType){\r\n\tif(expression === false){\r\n\t\tif(messageOrErrorType && typeof messageOrErrorType !== \"string\"){ // Check if custom error object passed\r\n\t\t\tthrow messageOrErrorType(arguments.length > 3 ? templatedMessage(arguments[2], slice.call(arguments,3)) : arguments[2]);\t\r\n\t\t} else {\r\n\t\t\tthrow new Error(arguments.length > 2 ? templatedMessage(messageOrErrorType, slice.call(arguments,2)) : messageOrErrorType);\t\r\n\t\t}\r\n\t}\r\n\treturn expression;\r\n};\r\n\r\n/** Throws a TypeError if a given expression is false\r\n*\r\n*\t@param {Boolean} expression The determinant of whether an exception is thrown\r\n*\t@param {String} [message] A message or message template for the error (if it gets thrown)\r\n*\t@param {...Object} [messageArgs] Arguments for a provided message template\r\n*\r\n*\t@returns {Boolean} Returns the expression passed  \r\n*\t@throws {TypeError}\r\n*\r\n*\t@example\r\n*\t\tits.type(typeof \"Team\" === \"string\"); // returns true\r\n*\t\tits.type(typeof \"Team\" === \"number\"); // throws TypeError with no message\r\n*\t\tits.type(void 0, \"Something went wrong!\"); // throws TypeError with message: \"Something went wrong!\"\r\n*\t\tits.type(void 0, \"%s went %s!\", \"something\", \"wrong\"); // throws TypeError with message: \"Something went wrong!\"\r\n*/\r\nits.type = function(expression, message){\r\n\tif(expression === false){\r\n\t\tthrow new TypeError(arguments.length > 2 ? templatedMessage(message, slice.call(arguments,2)) : message);\r\n\t}\r\n\treturn expression;\r\n};\r\n\r\n// Helpers\r\nits.undefined = function(expression){\r\n\treturn its.type.apply(null, [expression === void 0].concat(slice.call(arguments, 1)));\r\n};\r\n\r\nits.null = function(expression){\r\n\treturn its.type.apply(null, [expression === null].concat(slice.call(arguments, 1)));\r\n};\r\n\r\nits.boolean = function(expression){\r\n\treturn its.type.apply(null, [expression === true || expression === false || toString.call(expression) === \"[object Boolean]\"].concat(slice.call(arguments, 1)));\r\n};\r\n\r\nits.array = function(expression){\r\n\treturn its.type.apply(null, [toString.call(expression) === \"[object Array]\"].concat(slice.call(arguments, 1)));\r\n};\r\n\r\nits.object = function(expression){\r\n\treturn its.type.apply(null, [expression === Object(expression)].concat(slice.call(arguments, 1)));\r\n};\r\n\r\n/** This block creates \r\n*\tits.function\r\n*\tits.string\r\n*\tits.number\r\n*\tits.date\r\n*\tits.regexp\r\n*/\r\n(function(){\r\n\tvar types = [\r\n\t\t\t['args','Arguments'],\r\n\t\t\t['func', 'Function'], \r\n\t\t\t['string', 'String'], \r\n\t\t\t['number', 'Number'], \r\n\t\t\t['date', 'Date'], \r\n\t\t\t['regexp', 'RegExp']\r\n\t\t],\r\n\t\tindex = 0,\r\n\t\tlength = types.length;\r\n\r\n\tfor(; index < length; index++){\r\n\t\t(function(){\r\n\t\t\tvar theType = types[index];\r\n\t\t\tits[theType[0]] = function(expression){\r\n\t\t\t\treturn its.type.apply(null, [toString.call(expression) === '[object ' + theType[1] + ']'].concat(slice.call(arguments, 1)));\r\n\t\t\t};\r\n\t\t}());\r\n\t}\r\n}());\r\n\r\n// optimization from underscore.js by documentcloud -- underscorejs.org\r\nif (typeof (/./) !== 'function') {\r\n\tits.func = function(expression) {\r\n\t\treturn its.type.apply(null, [typeof expression === \"function\"].concat(slice.call(arguments, 1)));\r\n\t};\r\n}\r\n\r\n/** Throws a ReferenceError if a given expression is false\r\n*\r\n*\t@param {Boolean} expression The determinant of whether an exception is thrown\r\n*\t@param {String} [message] A message or message template for the error (if it gets thrown)\r\n*\t@param {...Object} [messageArgs] Arguments for a provided message template\r\n*\r\n*\t@returns {Object} Returns the expression passed  \r\n*\t@throws {ReferenceError}\r\n*\r\n*\t@example\r\n*\t\tits.defined(\"Something\"); // returns true\r\n*\t\tits.defined(void 0); // throws ReferenceError with no message\r\n*\t\tits.defined(void 0, \"Something went wrong!\"); // throws ReferenceError with message: \"Something went wrong!\"\r\n*\t\tits.defined(void 0, \"%s went %s!\", \"something\", \"wrong\"); // throws ReferenceError with message: \"Something went wrong!\"\r\n*/\r\nits.defined = function(expression, message){\r\n\tif(expression === void 0){\r\n\t\tthrow new ReferenceError(arguments.length > 2 ? templatedMessage(message, slice.call(arguments,2)) : message);\r\n\t}\r\n\r\n\treturn expression;\r\n};\r\n\r\n/** Throws a RangeError if a given expression is false\r\n*\r\n*\t@param {Boolean} expression The determinant of whether an exception is thrown\r\n*\t@param {String} [message] A message or message template for the error (if it gets thrown)\r\n*\t@param {...Object} [messageArgs] Arguments for a provided message template\r\n*\r\n*\t@returns {Boolean} Returns the expression passed  \r\n*\t@throws {RangeError}\r\n*\r\n*\t@example\r\n*\t\tits.range(1 > 0); // returns true\r\n*\t\tits.range(1 < 2); // throws RangeError with no message\r\n*\t\tits.range(1 < 2 && 1 > 2, \"Something went wrong!\"); // throws RangeError with message: \"Something went wrong!\"\r\n*\t\tits.range(1 < 2 && 1 > 2, \"%s went %s!\", \"something\", \"wrong\"); // throws RangeError with message: \"Something went wrong!\"\r\n*/\r\nits.range = function(expression, message){\r\n\tif(expression === false){\r\n\t\tthrow new RangeError(arguments.length > 2 ? templatedMessage(message, slice.call(arguments,2)) : message);\r\n\t}\r\n\r\n\treturn expression;\r\n};"],"sourceRoot":"/source/"}